(function(){var i=window.$MicrosoftMaps8,n=i.Internal,c=n._CurveColorHelper,t=n._Debug,l=n._Dispatcher,f=n._Gimme,e=n._Helper,a=n._ObservableObject,v=i.Point,o=i.Size,r=function(){function n(t,i){if(this.arrowDrawAccumulator=0,t&&t.substr(t.length-9)==="Singleton")return n[t]=n[t]||new n;this._canvas=i||e._createElement("canvas");this._canvasElem=this._canvas[0];this._context=this._canvasElem.getContext("2d");this._style=this._resetStyle={fillStyle:this._context.fillStyle,strokeStyle:this._context.strokeStyle,lineWidth:this._context.lineWidth}}return n.prototype.setGlobalAlpha=function(n){this._context.globalAlpha=n},n.prototype.getGlobalAlpha=function(){return this._context.globalAlpha},n.prototype.save=function(){this._context.save()},n.prototype.restore=function(n){this._context.restore();n!==!1&&(this._font=null,this._style=this._resetStyle)},n.prototype.getDataURL=function(){return this._canvasElem.toDataURL()},n.prototype.setSize=function(n,t){this._canvasElem.width=n;this._canvasElem.height=t},n.prototype.getSize=function(){return new o(this._canvasElem.width,this._canvasElem.height)},n.prototype.clear=function(n){if(n){var t=this._context.fillStyle;this._context.fillStyle=n;this._context.fillRect(0,0,this._canvasElem.width,this._canvasElem.height);this._context.fillStyle=t}else this._context.clearRect(0,0,this._canvasElem.width,this._canvasElem.height)},n.prototype.setFont=function(n){n!==this._font&&(this._context.font=n,this._font=n)},n.prototype.setStyle=function(n,t){var i,r,u;if(this._style!==n){if(this._style=n,t=t||1,this._context.fillStyle=this._style.fillStyle||"transparent",this._context.strokeStyle=this._style.strokeStyle||"transparent",this._context.lineWidth=Math.round(this._style.lineWidth*t)||0,this._context.lineCap=this._style.lineCap||"round",this._context.lineJoin=this._style.lineJoin||"round",this._context.setLineDash){if(i=[],this._style.dashes&&(i=this._style.dashes.slice(0)),i&&i.length>0)for(r=0;r<i.length;r++)i[r]=Math.round(i[r]*this._context.lineWidth);this._context.setLineDash(i)}if(u=this._style.fillImage,u&&typeof u!="number"&&(this._context.fillStyle=this._context.createPattern(u,"repeat")),this._style.font){var o=this._style.horizontalAlignment,s=this._style.verticalAlignment,f="center",e="middle";o===1?f="left":o===2&&(f="right");s===0?e="alphabetic":s===2&&(e="hanging");this._context.textAlign=f;this._context.textBaseline=e}}},n.prototype.getStyle=function(){return this._style},n.prototype.setPrimitive=function(){},n.prototype.hasPrimitives=function(){return!1},n.prototype.setLayer=function(){},n.prototype.getHitTestingData=function(){return null},n.prototype.flush=function(){this._needsFill&&this._context.fill();this._needsStroke&&this._style.lineWidth>0&&this._context.stroke();this._needsStroke=this._needsFill=!1;this._context.beginPath()},n.prototype.stroke=function(){var n=this._style,t,i;n.secondaryLineWidth>0&&(t=this._context.strokeStyle,i=this._context.lineWidth,this._context.strokeStyle=n.secondaryStrokeStyle,this._context.lineWidth=n.secondaryLineWidth,this._context.stroke(),this._context.strokeStyle=t,this._context.lineWidth=i);this._needsStroke=!0},n.prototype.fill=function(){this._needsFill=!0},n.prototype.getRawContext=function(){return this._context},n.prototype.getRootElement=function(){return this._canvas},n.prototype.drawImage=function(n,i,r,u,f,e,o,s,h,c){t.assertNotNull(n,"image");var l=this._context.globalAlpha;if(e&&(this._context.globalAlpha=e),u&&f&&typeof o=="number"&&typeof s=="number"&&h&&c)this._context.drawImage(n,o,s,h,c,i||0,r||0,u,f);else if(u&&f)this._context.drawImage(n,i||0,r||0,u,f);else try{this._context.drawImage(n,i||0,r||0)}catch(a){}this._context.globalAlpha=l},n.prototype.drawEllipse=function(n,t,i,r){if(i===r)this._context.arc(n,t,i,0,2*Math.PI,!1);else{var u=r/.75;this._context.beginPath();this._context.moveTo(n-i,t);this._context.bezierCurveTo(n-i,t+u,n+i,t+u,n+i,t);this._context.bezierCurveTo(n+i,t-u,n-i,t-u,n-i,t)}},n.prototype.lineTo=function(n,t,i,r){var u=this._style.dashes;!this._context.setLineDash&&u&&u.length>0?this._dashedLineTo(n,t,i||0,r||0,u):this._context.lineTo(n,t)},n.prototype.moveTo=function(n,t){this._context.moveTo(n,t)},n.prototype.dispose=function(){this._canvas&&(this._canvas.removeFromParent(),this._canvas.clear(),this._canvas=null);this._canvasElem=null;this._context=null},n.prototype._dashedLineTo=function(n,i,r,u,f){var s,l,c,e,v,y,o,p;t.assert(f.length%2==0,"Dashes count is odd number");s=n-r;l=i-u;Math.abs(s)>.005&&(c=l/s);var h=new Array(f.length),a=new Array(f.length),w=this._style.lineWidth;for(e=0;e<f.length;e++){if(o=Math.round(f[e]*w),t.assert(o>0,"Dash length is not positive"),o<1){this._context.lineTo(n,i);break}Math.abs(s)<=.005||Math.abs(c)>200?(h[e]=0,a[e]=l>0?o:-o):Math.abs(c)<.005?(h[e]=s>0?o:-o,a[e]=0):(h[e]=Math.sqrt(o*o/(1+c*c)),s<0&&(h[e]=-h[e]),a[e]=c*h[e])}for(v=Math.sqrt(s*s+l*l),y=!0,e=0;v>0;)o=f[e%f.length]*w,v>o?(p=e++%f.length,r+=h[p],u+=a[p]):(r=n,u=i),y?this._context.lineTo(r,u):this._context.moveTo(r,u),v-=o,y=!y},n}(),u=function(){function n(n,t,i){this._primitives=n||[];this._layers=t||[];this._imageData=i}return n.prototype.setResultToArgs=function(n,i,r){var u,s,h,c,e,o;if((t.assertNotNull(r,"args"),n=Math.round(n),i=Math.round(i),u=this.getResultIndex(n,i),!(u<0))&&(s=u>>16,h=u&65535,h<this._primitives.length&&s<this._layers.length)){if(f.Browser.is_webkit){r.primitive=this._primitives[h];r.layer=this._layers[s];return}for(c=0,e=i-1;e<=i+1;e++)for(o=n-1;o<=n+1;o++)if((o!==n||e!==i)&&this.getResultIndex(o,e)===u&&++c>1){r.primitive=this._primitives[h];r.layer=this._layers[s];return}}},n.prototype.getResultIndex=function(t,i){var u=-1,r;if(n.isPointWithinBoundary(t,i,this._imageData.width,this._imageData.height)&&this._imageData&&this._imageData.data&&(r=(this._imageData.width*i+t)*4,r>=0&&r+3<this._imageData.data.length)){var f=this._imageData.data[r],e=this._imageData.data[r+1],o=this._imageData.data[r+2],s=this._imageData.data[r+3];s===255&&(u=(f<<16)+(e<<8)+o)}return u},n.isPointWithinBoundary=function(n,t,i,r){return n>=0&&n<i&&t>=0&&t<r?!0:!1},n}(),s=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),h=function(n){function i(t){var i=n.call(this,t)||this;return i.disableSmoothing(),i._primitives=[],i._layers=[],i._layerIdToIndex={},i}return s(i,n),i.prototype.disableSmoothing=function(){for(var t,i=this.getRawContext(),r=["imageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","webkitImageSmoothingEnabled"],n=0,u=r.length;n<u;n++)if(t=r[n],i[t]){i[t]=!1;break}},i.prototype.setSize=function(t,i){n.prototype.setSize.call(this,t,i);this.disableSmoothing()},i.prototype.stroke=function(){this.getRawContext().stroke()},i.prototype.fill=function(){this.getRawContext().fill()},i.prototype.setPrimitive=function(n){if(n){this._currentPrimitiveIndex=this._primitives.length;var r=i.decimalToColorString(this._currentLayerIndex,this._currentPrimitiveIndex),t=this.getRawContext();t.fillStyle=t.strokeStyle=r;t.beginPath();this._primitives.push(n)}},i.prototype.hasPrimitives=function(){return!0},i.prototype.setLayer=function(n){t.assertNotNull(n,"layer");var r=n.getId(),i=this._layerIdToIndex[r];i||(this._layers.push(n),this._layerIdToIndex[r]=i=this._layers.length);this._currentLayerIndex=i},i.prototype.getHitTestingData=function(){var n=this.getSize();return new u(this._primitives,this._layers,this.getRawContext().getImageData(0,0,n.width,n.height))},i.prototype.clear=function(){this._primitives=[];this._layers=[];this._layerIdToIndex={};n.prototype.clear.call(this)},i.prototype.drawImage=function(n,i,r,u,f){t.assertNotNull(n,"image");u=u||n.naturalWidth||n.width;f=f||n.naturalHeight||n.height;this.getRawContext().fillRect(i||0,r||0,u,f)},i.prototype.setStyle=function(n){n.lineWidth&&(this.getRawContext().lineWidth=n.lineWidth+2)},i.decimalToColorString=function(n,i){var r,u;return t.assert(n>0,"layers is empty"),r=(n-1).toString(16).toUpperCase(),t.assert(r.length<=2,"Hit testing layers number exceeds #FF"),u=r.length===1?"#0"+r+"0000":"#"+r+"0000",r=i.toString(16).toUpperCase(),t.assert(r.length<=4,"Hit testing primitives number exceeds #00FFFF"),u.substring(0,u.length-r.length)+r},i}(r);n.CanvasDrawingContext=r;n.HitTestingCanvasDrawingContext=h;n.HitTestingData=u}).call(window)