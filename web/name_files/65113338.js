(function(){function e(n){return n?typeof n=="string"?n:n.toRgba():null}function b(n){var t,r,i,u;if(typeof n=="string")for(r=n.split(/[, ]/),t=[],i=0;i<r.length;i++)u=parseInt(r[i]),isNaN(u)||t.push(u);else t=n;return t}var n=window.$MicrosoftMaps8,u=n.Internal,p=n.Anchor,nt=u._Color,ir=n.CompositeMapMode,rr=u.CanvasDrawingContext,dt=n.DefaultTemplateSelector,at=n.BasicTemplate,et=n.BirdseyeV2Manager,gt=n.BirdseyeV2Metadata,ni=n.BitmapImageTemplate,ur=u._BoundsAccumulator,o=u._Gimme,i=u._Helper,r=u._JSEvent,fr=u._LatLonCrs,ot=n.LocationRect,v=u.MapHelper,ti=n.MapLayer,a=n.Location,ii=n.MapView,ri=n.MercatorCubeCrs,vt=u._MercatorTileUtility,ui=u._ObservableCollection,fi=n.VectorMapLayer,ei=u._Overlay,oi=u.ControlTemplate,tt=u._Observable,er=u._ObservableObject,s=u._ObservableObjectChangedArgs,or=u._OverlayEntity,si=n.ImageryMapLayer,f=n.Point,hi=n.RasterImageryScene,ci=n.SimpleAreaPrimitive,li=n.SimpleLinePrimitive,ai=n.SimplePointPrimitive,st=n.LabelVisibility,vi=u._BaseMapTemplateSelector;n.LabelOverlay=st;var sr=n.Size,yt=n.VectorImageTemplate,it=n.ZoomLevel,t=n.MapTypeId,ht=u._MapAuthentication,yi=u._LoggingWrapper,pi='<div style:display="{Binding visible Converter=boolToDisplay}" style:z-index="{Binding zIndex}">    <div class="{Binding options Converter=optionsToClass}" style:display="{Binding isDefault Converter=boolToDisplay}" data-tag="SDK.Infobox">        <a class="infobox-close" href="javascript:void(0)" event:click="_onCloseClicked" event:touchstart="_onCloseClicked" style:display="{Binding showCloseButton Converter=boolToDisplay}" data-tag="SDK.Infobox.CloseBtn">            <img class="infobox-close-img" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE0cHgiIHdpZHRoPSIxNHB4IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiPjxwYXRoIGQ9Ik03LDBDMy4xMzQsMCwwLDMuMTM0LDAsN2MwLDMuODY3LDMuMTM0LDcsNyw3YzMuODY3LDAsNy0zLjEzMyw3LTdDMTQsMy4xMzQsMTAuODY3LDAsNywweiBNMTAuNSw5LjVsLTEsMUw3LDhsLTIuNSwyLjVsLTEtMUw2LDdMMy41LDQuNWwxLTFMNyw2bDIuNS0yLjVsMSwxTDgsN0wxMC41LDkuNXoiLz48L3N2Zz4=" alt="close infobox" />        <\/a>        <div class="infobox-body">            <div class="infobox-title" data-tag="SDK.Infobox.Title">                <TextBlock Text="{Binding title}" />            <\/div>            <div class="infobox-info" data-tag="SDK.Infobox.Description" style:display="{Binding showDescription Converter=boolToDisplay}">            <\/div>            <div class="infobox-actions" style:display="{Binding actions Converter=boolToDisplay}" data-tag="SDK.Infobox.Actions">                <ul class="infobox-actions-list">                    <ItemsControl ItemsSource="{Binding actions}">                        <ItemsControl.ItemTemplate>                            <DataTemplate>                                <li>                                    <a href="javascript:void(0)" title="{Binding label}" event:click="eventHandler"  event:touchstart="eventHandler">                                        <TextBlock Text="{Binding label}" />                                    <\/a>                                <\/li>                            <\/DataTemplate>                        <\/ItemsControl.ItemTemplate>                    <\/ItemsControl>                <\/ul>            <\/div>        <\/div>        <div class="infobox-stalk" style:display="{Binding showPointer Converter=boolToDisplay}" data-tag="SDK.Infobox.Pointer">        <\/div>    <\/div>    <div id="InfoboxCustom" style:display="{Binding isCustom Converter=boolToDisplay}">    <\/div><\/div>',c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ct=function(n){function t(i,u){var f=n.call(this,null,null,null)||this,e;return f._changeVisibilityDisposable=null,f._registeredJsEvents={},f._options={visible:t._defaultOptions.visible,showCloseButton:t._defaultOptions.showCloseButton,showPointer:t._defaultOptions.showPointer,offset:t._defaultOptions.offset,title:t._defaultOptions.title,description:t._defaultOptions.description,actions:t._defaultOptions.actions,maxHeight:t._defaultOptions.maxHeight,maxWidth:t._defaultOptions.maxWidth,closeDelayTime:t._defaultOptions.closeDelayTime,location:i},e=Microsoft.Maps.GlobalConfig,e.isMapsAnswer||e.isMapsVertical||(f._options.zIndex=t._defaultOptions.zIndex),f.setOptions(u,!0),f.infoboxChanged=new r,f._visibleBeforeAnchorOutofBounds=!1,f}return c(t,n),t.prototype.getActions=function(){return this._options.actions},t.prototype.getDescription=function(){return this._options.description},t.prototype.getHeight=function(){this._createControl();var n;return n=this._customInfobox?this._control.select("#InfoboxCustom"):this._control.select(".Infobox"),n.get_size().height},t.prototype.getHtmlContent=function(){return this._options.htmlContent},t.prototype.getLocation=function(){return this._options.location},t.prototype.getMaxHeight=function(){return this._options.maxHeight},t.prototype.getMaxWidth=function(){return this._options.maxHeight},t.prototype.getOffset=function(){return this._options.offset},t.prototype.getOptions=function(){return this._options},t.prototype.getShowCloseButton=function(){return this._options.showCloseButton},t.prototype.getShowDescription=function(){return typeof this._options.description!="undefined"},t.prototype.getShowPointer=function(){return this._options.showPointer},t.prototype.getTitle=function(){return this._options.title},t.prototype.getVisible=function(){var n=this._map&&this._map.getOverlays();return!this._map||!n||n.indexOf(this)===-1?!1:this._options.visible},t.prototype.getWidth=function(){this._createControl();var n;return n=this._customInfobox?this._control.select("#InfoboxCustom"):this._control.select(".Infobox"),n.get_size().width},t.prototype.getZIndex=function(){return this._options.zIndex},t.prototype.getIsCustom=function(){return this._customInfobox},t.prototype.getIsDefault=function(){return!this._customInfobox},t.prototype.setHtmlContent=function(n){this.setOptions({htmlContent:n})},t.prototype.setLocation=function(n){this.setOptions({location:n})},t.prototype.setOptions=function(n,t){var i=this,r=0;n&&(typeof n.closeDelayTime=="number"&&(this._options.closeDelayTime=n.closeDelayTime),this._options.title=typeof n.title=="string"?n.title:this._options.title,this._options.description=typeof n.description=="string"?n.description:this._options.description,this._options.actions=n.actions?n.actions:this._options.actions,this._options.autoAlignment=typeof n.autoAlignment=="boolean"?n.autoAlignment:this._options.autoAlignment,this._options.showCloseButton=typeof n.showCloseButton=="boolean"?n.showCloseButton:this._options.showCloseButton,this._options.showPointer=typeof n.showPointer=="boolean"?n.showPointer:this._options.showPointer,this._options.offset=n.offset?n.offset:this._options.offset,this._options.zIndex=typeof n.zIndex=="number"?n.zIndex:this._options.zIndex,this._options.location=n.location?n.location:this._options.location,this._options.htmlContent=typeof n.htmlContent=="string"?n.htmlContent:this._options.htmlContent,this._options.maxHeight=typeof n.maxHeight=="number"?n.maxHeight:this._options.maxHeight,this._options.maxWidth=typeof n.maxWidth=="number"?n.maxWidth:this._options.maxWidth,typeof n.visible=="boolean"&&(n.visible||!this._options.visible||t||(r=this._options.closeDelayTime),this._options.visible=n.visible));this._createDescription();this.setAlignment(this._options.location);this._createCustomInfobox();this._options.visible&&this._timerId&&clearTimeout(this._timerId);this._timerId=setTimeout(function(){i.changed.invoke(new s(i,"options",i._options,n));i._adjustInfoboxSize();i.infoboxChanged&&i.infoboxChanged.invoke({target:i,targetType:"infobox",eventName:"infoboxChanged"})},r)},t.prototype.setMap=function(n){var t=this,i=n,r;n?(this._createControl(),this._mouseenterVisibilityHandlerId=y.addHandler(this,"mouseenter",function(){t._cachedVisibilitySetting=t._options.visible;t._cachedVisibilitySetting||t.setOptions({visible:!0})}),this._mouseleaveVisibilityHandlerId=y.addHandler(this,"mouseleave",function(){t._cachedVisibilitySetting||t.setOptions({visible:!1})}),n instanceof ft&&(i=n.getV8Map()),this._map=i,r=i.getOverlays(),r?(i.getOverlays().insert(this),this.changed.invoke(),this._createDescription(),this._createCustomInfobox(),this._adjustInfoboxSize()):i.overlayManagerLoaded.addOne(function(){i.getOverlays().insert(t);t.changed.invoke();t._createDescription();t._createCustomInfobox();t._adjustInfoboxSize()}),i.getMapOptions().allowInfoboxOverflow&&this._listenToMapChangedEvent()):this._map&&this._control&&(i=this._map,r=i.getOverlays(),r?(i.getOverlays().remove(this),this.changed.invoke()):i.overlayManagerLoaded.addOne(function(){i.getOverlays().remove(t);t.changed.invoke()}),this._changeVisibilityDisposable&&this._changeVisibilityDisposable.dispose())},t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype.optionsToClass=function(n){var t="Infobox";return n&&(n.title||(t=t+" no-title"),n.showCloseButton||(t=t+" no-close")),t},t.prototype.dispose=function(){if(this.setMap(null),this.click&&this.click.dispose(),this.infoboxChanged&&this.infoboxChanged.dispose(),this.mouseenter&&this.mouseenter.dispose(),this.mouseleave&&this.mouseleave.dispose(),this._control){for(var t in this._registeredJsEvents)i._undefineJSEventForDomEvent(this._control,t,this._registeredJsEvents[t].id),this._registeredJsEvents[t].dispose();this._control.removeFromParent();this._control.remove_event("click",this._clickHandler);this._control.remove_event("mouseenter",this._mouseenterHandler);this._control.remove_event("mouseleave",this._mouseleaveHandler);y.removeHandler(this._mouseenterVisibilityHandlerId);y.removeHandler(this._mouseleaveVisibilityHandlerId);this._control=null}n.prototype.dispose.call(this);i._nullifyClass(this)},t.prototype._createControl=function(){var n=this,f,u,t;if(!this._control){for(this.click=new r,this.mouseenter=new r,this.mouseleave=new r,this._control=new oi(pi,this).applyDataTemplate(this),f={stopPropagation:!0},u=["mousemove","mousedown","mouseup","mousewheel","click","dblclick","contextmenu","touchmove","touchstart","touchend"],t=0;t<u.length;t++)this._registeredJsEvents[u[t]]=i._defineJSEventForDomEvent(this._control,u[t],f);this._clickHandler=function(t){n.click&&n.click.invoke({target:n,targetType:"infobox",eventName:"click",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("click",this._clickHandler);this._mouseenterHandler=function(t){n.mouseenter&&n.mouseenter.invoke({target:n,targetType:"infobox",eventName:"mouseenter",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("mouseenter",this._mouseenterHandler);this._mouseleaveHandler=function(t){n.mouseleave&&n.mouseleave.invoke({target:n,targetType:"infobox",eventName:"mouseleave",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("mouseleave",this._mouseleaveHandler);this.setOverlayElement(this._control)}},t.prototype._onCloseClicked=function(){this.setOptions({visible:!1},!0)},t.prototype._changeAnchor=function(){var i,u,o,e,l;if(this._customInfobox?(e=this._control.select("#InfoboxCustom"),e&&e[0]&&(u=e.get_size().height,o=e.get_size().width,i=new f(e[0].offsetLeft,e[0].offsetHeight))):(l=this._control.get_style("display"),this._control.set_style({display:""}),u=this._control.select(".infobox-body").get_size().height,o=this._control.select(".infobox-body").get_size().width,this._control.set_style({display:l}),i=this._options.showPointer?new f(o/2,u+t._pointerHeight):new f(0,u)),i=i.subtract(new f(this._options.offset.x,-this._options.offset.y)),this._options.autoAlignment&&this._map&&o&&u){var a=this._map,s=a.getViewport(),r=a.getViewportPadding(),h=this._map.getMode().tryLocationToPoint(this._options.location),n=new f(h.x-i.x,h.y-i.y),c=10;n.x<r.left?n.x=r.left+c:n.x+o>s.pixelWidth-r.right&&(n.x=s.pixelWidth-r.right-o-c);n.y<r.top?n.y=r.top+c:n.y+u>s.pixelHeight-r.bottom&&(n.y=s.pixelHeight-r.bottom-u-c);i=new f(h.x-n.x,h.y-n.y)}this.setAnchor(i)},t.prototype._adjustInfoboxSize=function(){var n,i,f,r,s;if(this._control){if(!this._customInfobox){n=this._control.select(".infobox-body");i=this._control.select(".infobox-info");n.set_style({maxWidth:this._options.maxWidth+"px",maxHeight:this._options.maxHeight+"px"});this._control.set_style({display:""});f=this._control.get_style("left");this._control.set_style({left:"0px"});n.set_style({width:""});r=n.get_size().width;n.set_style({width:r});var u=n.get_size().height,h=parseInt(getComputedStyle(i[0],null).paddingTop.replace("px",""))||0,c=parseInt(getComputedStyle(i[0],null).paddingBottom.replace("px",""))||0,e=this._control.select(".infobox-title").get_size().height,o=this._control.select(".infobox-actions").get_size().height;e+i.get_size().height+o>u&&(s=u-e-o-h-c,i.set_style({maxHeight:s+"px"}));this._control.set_style({display:this.boolToDisplay(this.getVisible()),left:f});this._control.select(".infobox-stalk").set_style({top:u-.2+"px",left:(r-t._pointerWidth)/2+"px"})}this._changeAnchor()}},t.prototype._createCustomInfobox=function(){var t=this._options&&this._options.htmlContent,n,i;t&&(n=this._control&&this._control.select("#InfoboxCustom"),n&&n.length>0&&(n.clear(),i=document.createElement("div"),i.innerHTML=t,n[0].appendChild(i),this._customInfobox=!0,this.changed.invoke(new s(this,"htmlContent",undefined,t))))},t.prototype._createDescription=function(){var n,t;this._control&&(n=this._control.select(".infobox-info")[0],n&&(n.innerHTML="",this._options.description&&(t=document.createElement("div"),t.innerHTML=this._options.description,n.appendChild(t))))},t.prototype._listenToMapChangedEvent=function(){var n=this,t=null;this._map&&(t=this._map.getMapOptions());t&&t.allowInfoboxOverflow&&(this._changeVisibilityDisposable=this._map.viewChanged.add(function(){n._visibleBeforeAnchorOutofBounds&&n._map.getBounds().contains(n.getLocation())&&(n.setOptions({visible:!0}),n._visibleBeforeAnchorOutofBounds=!1);n.getOptions().visible&&!n._map.getBounds().contains(n.getLocation())&&(n._visibleBeforeAnchorOutofBounds=!0,n.setOptions({visible:!1},!0))}))},t._pointerWidth=14,t._pointerHeight=16,t._defaultOptions={visible:!0,showCloseButton:!0,showPointer:!0,offset:new f(0,0),maxHeight:126,maxWidth:256,zIndex:1002,closeDelayTime:0},t}(ei),pt=function(){function n(n,t,i,r){this.a=n>1?n/255:n;this.r=t;this.g=i;this.b=r}return n.clone=function(t){var i;return t&&(i=new n(t.a,t.r,t.g,t.b)),i},n.fromHex=function(t){var r,i;return t&&(i=parseInt(t.slice(1),16),r=new n(255,i>>16&255,i>>8&255,i&255)),r},n.fromRGBA=function(t){var u=t.indexOf("("),f=t.indexOf(")"),i,r;if(u===-1||f===-1)return null;if(i=t.slice(u+1,f).split(","),r=null,i&&i.length===4){var e=parseInt(i[0]),o=parseInt(i[1]),s=parseInt(i[2]),h=parseFloat(i[3]);r=new n(h,e,o,s)}return r},n.prototype.clone=function(){return n.clone(this)},n.prototype.getOpacity=function(){return this.a},n.prototype.toHex=function(n){var t="#",i;if(n)for(i=0;i<n.length;i++)switch(n.charAt(i)){case"a":t+=this._toHexInternal(Math.floor(this.a*255));break;case"r":t+=this._toHexInternal(this.r);break;case"g":t+=this._toHexInternal(this.g);break;case"b":t+=this._toHexInternal(this.b)}else t+=this._toHexInternal(this.r)+this._toHexInternal(this.g)+this._toHexInternal(this.b);return t},n.prototype.toRgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},n.prototype._toHexInternal=function(n){var t=n.toString(16);return t.length==1?"0"+t:t},n}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wi=function(n){function t(i){var r=n.call(this,null,new ii(it.toLocation(new a(0,0),0,!0)),ri.instance,"CustomTileSource_"+t._tileSourceId++,i&&i.uriConstructor?i.uriConstructor:undefined,null,null)||this;return r._options=i,r}return c(t,n),t.prototype.getHeight=function(){return vt.tileSize},t.prototype.getUriConstructor=function(){return this._tileUrlTemplate},t.prototype.getWidth=function(){return vt.tileSize},t.prototype.toString=function(){throw"Not supported";},t.prototype.getBounds=function(){return this._options&&this._options.bounds},t.prototype.getMinZoom=function(){return this._options&&this._options.minZoom},t.prototype.getMaxZoom=function(){return this._options&&this._options.maxZoom},t._tileSourceId=0,t}(hi),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wt=function(n){function t(i){var r=n.call(this,"CustomLayer_"+t._tileId++)||this;return r._options={zIndex:t._defaultOptions.zIndex,visible:t._defaultOptions.visible,opacity:t._defaultOptions.opacity,downloadTimeout:t._defaultOptions.downloadTimeout,enableCORS:t._defaultOptions.enableCORS},r.setOptions(i),r}return c(t,n),t.prototype.getTileSource=function(){return this._options.mercator},t.prototype.setOptions=function(n){if(n&&(this._downloadTimeoutInMS=Math.min(t._maxDownloadTimeout,this._options.downloadTimeout=typeof n.downloadTimeout=="number"?n.downloadTimeout:this._options.downloadTimeout),this._options.opacity=typeof n.opacity=="number"?n.opacity:this._options.opacity,this._options.visible=typeof n.visible=="boolean"?n.visible:this._options.visible,this._options.zIndex=typeof n.zIndex=="number"?n.zIndex:this._options.zIndex,this._enableCORS=this._options.enableCORS=typeof n.enableCORS=="boolean"?n.enableCORS:this._options.enableCORS,this.setVisible(this._options.visible),this.setZIndex(this._options.zIndex),this.setOpacity(this._options.opacity),!this._options.mercator&&n.mercator)){this._options.mercator=n.mercator;this._options.mercator.downloadTimeOut=this._options.downloadTimeout;var i=this._options.mercator.getMinZoom(),r=this._options.mercator.getMaxZoom(),u=this._options.mercator.getBounds();this.addScene(0,this._options.mercator,0,null,it.toScale(null,r,!0),it.toScale(null,i,!0),u)}},t.prototype.toString=function(){throw"Not supported";},t._defaultOptions={zIndex:1e4,visible:!0,opacity:1,downloadTimeout:5e3,enableCORS:!1},t._tileId=0,t._maxDownloadTimeout=3e4,t}(si),rt=function(){function t(){}return t.loadModule=function(i,r){function l(){a--;a!==0||b||c&&c()}var f=[],e,k,o,v,u,s,y,p;typeof i=="string"?f.push(i):f=i;var a=f.length,h,c=r,w,b=!1;if(typeof r=="object"&&(e=r,c=e.callback,h=e.credentials?e.credentials:n.Credentials,w=e.errorCallback),h&&(k=new ht(h,Microsoft.Maps.Internal._CoreConfig().logServiceUrlFormat,new yi,!0)),t.container)for(o=0,v=f.length;o<v;o++)if(u=t._supportedModules[f[o]],u)if(u.isLoaded){for(l(),s=0,y=u.pendingCallbacks.length;s<y;s++)u.pendingCallbacks[s]();u.pendingCallbacks=[]}else p=u.dragonflyObjectName,p?t._createInstance(f[o],u,l):u.pendingCallbacks.push(l)},t.registerModule=function(n,i,r){var o,u,f,s,e;if(n&&i&&(t._supportedModules[n]={isLoaded:!1,pendingCallbacks:[]},o=document.getElementsByTagName("head")[0],u=document.createElement("script"),u.type="text/javascript",u.src=i,o.appendChild(u),r&&r.styleURLs))for(f=0,s=r.styleURLs.length;f<s;f++)e=document.createElement("link"),e.rel="stylesheet",e.href=r.styleURLs[f],o.appendChild(e)},t.moduleLoaded=function(n){var i,r,u;if(n){for(i=t._supportedModules[n],i.isLoaded=!0,r=0,u=i.pendingCallbacks.length;r<u;r++)i.pendingCallbacks[r]();i.pendingCallbacks=[]}},t._createInstance=function(n,i,r){t.container.instanceAsync(i.dragonflyObjectName,function(){t._instrumentModuleCreation(n);i.isLoaded=!0;r();for(var u=0,f=i.pendingCallbacks.length;u<f;u++)i.pendingCallbacks[u]();i.pendingCallbacks=[]})},t._instrumentModuleCreation=function(n){if(Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger){var t={feature:"SDK",action:"ModuleLoaded",data:{moduleName:n}};Microsoft.Maps.logger.logObject(t,null,!0)}},t._supportedModules={"Microsoft.Maps.DrawingTools":{dragonflyObjectName:"DrawingToolsModule",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.WellKnownText":{dragonflyObjectName:"WellKnownText",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoJson":{dragonflyObjectName:"GeoJson",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoXml":{dragonflyObjectName:"GeoXml",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialDataService":{dragonflyObjectName:"GeoDataAPIManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AutoSuggest":{dragonflyObjectName:"AutosuggestManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.HeatMap":{dragonflyObjectName:"HeatMapLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Clustering":{dragonflyObjectName:"ClusterLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialMath":{dragonflyObjectName:"SpatialMath",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Search":{dragonflyObjectName:"SearchManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Traffic":{dragonflyObjectName:"TrafficManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Directions":{dragonflyObjectName:"DirectionsManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.DataBinning":{dragonflyObjectName:"DataBinningLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Contour":{dragonflyObjectName:"ContourLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Isochrone":{dragonflyObjectName:"IsochroneLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.VenueMaps":{dragonflyObjectName:"VenueMap",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AdvancedShapes":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Themes.BingTheme":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Overlays.Style":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]}},t}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),lt=function(n){function t(i,u,f){var e=this;return typeof f!="number"&&(f=t._zIndex++),e=n.call(this,i,null,null,f)||this,e._changedEventHandlers=[],e._disposables.push(e.primitiveMoveStarted.add(function(n){return e._onPrimitiveMoved(n,!0)}),e.primitiveMoveContinued.add(function(n){return e._onPrimitiveMoved(n,!0)}),e.primitiveMoveStopped.add(function(n){return e._onPrimitiveMoved(n,!1)}),e.invalidated=new r),e.setTemplateSelector(u?u:t._getDefaultTemplateSelector()),e._primitives=[],e.setDataSource(e),e.setRenderTarget(1),e.overlayEvent=0,e}return c(t,n),t._getDefaultTemplateSelector=function(){return t._defaultTemplateSelector||(t._defaultTemplateSelector=new dt),t._defaultTemplateSelector},t.prototype.clear=function(){this._lastClearedPrimitives=this._primitives;i._clearDisposables(this._changedEventHandlers);this._primitives=[];this.raiseInvalidatedEvent()},t.prototype.add=function(n,t){var i,r,u,f,e;for(i=typeof n.length=="number"?n:[n],t?(r=[t,0],r=r.concat(i),Array.prototype.splice.apply(this._primitives,r)):Array.prototype.push.apply(this._primitives,i),u=0,f=i.length;u<f;u++)e=i[u],e.layer=this;this._observePrimitiveChanges(i);this.raiseInvalidatedEvent()},t.prototype.remove=function(n){var t=this._primitives.indexOf(n);return this.removeAt(t)},t.prototype.removeAt=function(n){var i,t;return n>=0&&n<this._primitives.length&&(i=this._primitives.splice(n,1)[0],t=this._changedEventHandlers[n],t&&t.dispose(),this._changedEventHandlers.splice(n,1),this.raiseInvalidatedEvent()),i},t.prototype.getPrimitives=function(n,t){var i,r,f,u;if(!n&&!t)return this._primitives;if(i=[],this._primitives&&this.getVisible())for(r=0,f=this._primitives.length;r<f;r++)u=this._primitives[r],(!u.getVisible||u.getVisible())&&i.push(u);return t&&t({primitives:i}),i},t.prototype.setPrimitives=function(n){this.clear();this.add(n,null)},t.prototype.raiseInvalidatedEvent=function(){var n=this;this._invalidatedQueued||(this._invalidatedQueued=!0,window.setTimeout(function(){n._invalidatedQueued=!1;n.invalidated&&n.invalidated.invoke()},0))},t.prototype.dispose=function(t){t&&(i._clearDisposables(this._primitives),i._clearDisposables(this._lastClearedPrimitives));i._clearDisposables(this._changedEventHandlers);this._primitives=[];this._lastClearedPrimitives=[];n.prototype.dispose.call(this)},t.prototype._observePrimitiveChanges=function(n,t){var h=this,f,i,r,s,e,o,u;for(f=typeof n.length=="number"?n:[n],i=[],r=0,s=f.length;r<s;r++)e=null,o=f[r],o.changed&&(e=o.changed.add(function(){return h._onPrimitiveChanged()})),i.push(e);t?(u=[t,0],u=u.concat(i),Array.prototype.splice.apply(this._changedEventHandlers,u)):Array.prototype.push.apply(this._changedEventHandlers,i)},t.prototype._onPrimitiveChanged=function(){this.raiseInvalidatedEvent()},t.prototype._onPrimitiveMoved=function(n,t){var i=n.primitive,r;i instanceof l&&i.isMoveEnabled()&&(r=i,r.setLocation(n.location,t))},t._zIndex=1e4,t}(fi),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),k=function(){function n(n,t){this.collection=n;this.data=t}return n}(),bt=function(n){function t(i,u){var f=n.call(this,"EntityCollectionLayer_"+t._layerId++,null,i&&i.zIndex)||this;return f._infoboxCollection=[],f._options={},f._options.zIndex=f.getZIndex(),f._options.visible=i&&typeof i.visible=="boolean"?i.visible:t._defaultOptions.visible,f.setVisible(f._options.visible),f._disposables.push(f.entityadded=new r,f.entitychanged=new r,f.entityremoved=new r),f._childCollectionElementAddedHandlers={},f._childCollectionElementRemovedHandlers={},f._childCollections={},f._v8map=u,f}return c(t,n),t.prototype.get=function(n){return n>=0&&n<this._primitives.length?this._primitives[n]:null},t.prototype.getLength=function(){return this._primitives.length},t.prototype.indexOf=function(n){return this._primitives.indexOf(n)},t.prototype.insert=function(n,t){this._addInternal(n,t)},t.prototype.pop=function(){return this.removeAt(this._primitives.length-1)},t.prototype.push=function(n){this._addInternal(n)},t.prototype.remove=function(i){var u=[],r=[],e,o;if(i instanceof t){i.getPrimitives(null,function(n){u=n.primitives});var f=i.getId(),s=this._childCollectionElementAddedHandlers[f],h=this._childCollectionElementRemovedHandlers[f];i.entityadded.remove(s);i.entityremoved.remove(h);delete this._childCollectionElementAddedHandlers[f];delete this._childCollectionElementRemovedHandlers[f];delete this._childCollections[f]}else i instanceof Array?u=i:u.push(i);for(e=0;e<u.length;e++)o=n.prototype.remove.call(this,u[e]),o&&r.push(o);return r.length===0?null:r.length===1?(this.entityremoved.invoke(new k(this,r[0])),r[0]):(this.entityremoved.invoke(new k(this,r)),r)},t.prototype.removeAt=function(t){var i=n.prototype.removeAt.call(this,t);return i&&this.entityremoved.invoke(new k(this,i)),i},t.prototype.clear=function(){var t,i;for(t in this._childCollections)this._childCollections[t].entityadded.remove(this._childCollectionElementAddedHandlers[t]),this._childCollections[t].entityremoved.remove(this._childCollectionElementRemovedHandlers[t]);this._childCollectionElementAddedHandlers={};this._childCollectionElementRemovedHandlers={};this._childCollections={};i=this._primitives;n.prototype.clear.call(this);this.entityremoved.invoke(new k(this,i))},t.prototype.setOptions=function(n){this._options=n},t.prototype.toString=function(){throw"not implemented";},t.prototype.dispose=function(t){this._options=null;this._childCollectionElementAddedHandlers=null;this._childCollectionElementRemovedHandlers=null;this._childCollections=null;i._clearDisposables(this._disposables);n.prototype.dispose.call(this,t)},t.prototype._addInfoboxHelper=function(n){if(n)for(var t=0;t<n.length;t++)this.push(n[t])},t.prototype._addInternal=function(i,r){var s=this,f,u,e,o;i instanceof ct?(this._v8map&&(console.warn("This API is deprecated. Please use Infobox.setMap. For more information please see https://www.bing.com/api/maps/sdkrelease/mapcontrol/isdk#addDefaultInfobox+JS"),i.setMap(this._v8map)),this._infoboxCollection.push(i)):i instanceof t?(this._addInfoboxHelper(i._infoboxCollection),i.getPrimitives(null,function(n){f=n.primitives}),u=i.getId(),e=this._childCollectionElementAddedHandlers[u],e||(e=function(n){n.data&&s.push(n.data);n.collection&&s._addInfoboxHelper(n.collection._infoboxCollection)},this._childCollectionElementAddedHandlers[u]=e,this._disposables.push(i.entityadded.add(e))),o=this._childCollectionElementRemovedHandlers[u],o||(o=function(n){n.data&&s.remove(n.data)},this._childCollectionElementRemovedHandlers[u]=o,this._disposables.push(i.entityremoved.add(o))),this._childCollections[u]||(this._childCollections[u]=i)):f=i;f=f||[];n.prototype.add.call(this,f,r);this.entityadded.invoke(new k(this,f))},t._layerId=1,t._defaultOptions={visible:!0},t}(lt),y=function(){function n(){}return n.addHandler=function(t,i,r){var u=n._getWrappedEventArgs(t,i,r);return u.target[u.eventName].add(u.callback)},n.addThrottledHandler=function(t,i,r,u){var f=n._getWrappedEventArgs(t,i,r);return f.target[f.eventName].addThrottled(f.callback,u)},n.hasHandler=function(t,i){var r=n._getWrappedEventArgs(t,i);return r.target[r.eventName].hasHandlersRegistered()},n.invoke=function(t,i,r){var u=n._getWrappedEventArgs(t,i);u.target[u.eventName].invoke(r)},n.removeHandler=function(n){n&&n.dispose()},n.addOne=function(t,i,r){var u=n._getWrappedEventArgs(t,i,r);u.target[u.eventName].addOne(u.callback)},n._getWrappedEventArgs=function(n,t,i){var u={target:n,eventName:t,callback:i},e,o,s,h,f;return n instanceof ft?(u.callback=function(t){t&&(t.target=n,t.targetType="map");i&&i(t)},e={click:"mapTapped",rightclick:"contextMenuInvoked",maptypechanged:"mapTypeChanged",mousedown:"pointerPressed",mouseup:"pointerReleased",mousemove:"pointerMoved",mouseover:"pointerEntered",mouseout:"pointerExited",mousewheel:"pointerWheelChanged",dblclick:"mapDoubleTapped",mapresize:"mapResized",mapsetview:"setViewInvoked"},f=e[t],f&&(u.eventName=f,u.target=n.getV8Map())):n instanceof l||n instanceof w||n instanceof d?(o={click:"click",dblclick:"dblclick",drag:"drag",dragend:"dragend",dragstart:"dragstart",mousedown:"mousedown",mouseup:"mouseup",mouseout:"mouseout",mouseover:"mouseover",changed:"changed"},u.eventName=o[t],u.eventName&&!u.target[u.eventName]&&(u.target[u.eventName]=new r)):n instanceof ct?(s={click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",infoboxChanged:"infoboxChanged"},u.eventName=s[t],u.eventName&&!u.target[u.eventName]&&(u.target[u.eventName]=new r)):n instanceof lt&&(u.callback=function(n){n&&(n.targetType="layer",n.eventName=t);i&&i(n)},h={click:"primitiveTapped",dblclick:"primitiveDoubleTapped",rightclick:"contextMenuInvoked",mouseup:"primitivePointerReleased",mouseover:"primitiveHoverStarted",mousedown:"primitivePointerPressed",mouseout:"primitiveHoverStopped"},f=h[t],f&&(u.eventName=f)),u},n}(),kt=function(){function n(n){var t=this;this._map=n;this._disposables=[];this._disposables.push(this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)}))}return n.prototype.selectorReady=function(){var n=this;return!this.baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n.baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n.baseMapTemplateSelector.selectorReady()}):this.baseMapTemplateSelector.selectorReady()},n.prototype.getTemplates=function(t){var i=[],o,u,r,y,a,w,e,s,b;if(t instanceof l)if(o=t.bucket===vi.pricePoiBucketId,t.bucket===l.defaultPushpinBucketId||t.bucket===l.defaultClickedPushpinBucketId||t.bucket===l.areaLabelBucketId||o)if(t.bucket===l.areaLabelBucketId&&tt.setValue(t,"style",n._venueMapAreaLabelStyle),u=tt.getValue(t,"image"),u)r=tt.getValue(t,"anchor"),r instanceof f?r=new p(r.x,r.y):r instanceof p||(r=new p(0,0)),tt.setValue(t,"anchor",r),i.push(new ni(u,1,r)),!t.hasSvgText&&t.getText()&&(y=this._getTextAnchor(u.width,t.getTextOffset()),i=i.concat(this.baseMapTemplateSelector.getPushpinTextTemplates(null,u,y,r)));else{var h=t.getState(),k=this._map.getMercatorZoomLevel(),c=n._pushpinColorIndex;if(t.taskDisplayState&&(c=t.taskDisplayState.colorIndex),t.isMicroPoi)i=this._getMicroPoiTemplate(c,h);else{if(a=t.getText(),w=a&&a.length>0,i=this.baseMapTemplateSelector.getPoiVectorImageTemplate(t.catId,v._getColorMapping(c),h,k,o?2:1,!o||w?!0:!1),h!==4&&t.getText()){for(e=!1,s=0,b=i.length;s<b;s++)if(e=e||i[s].hasPlaceholderText,e)break;e||(i=i.concat(this.baseMapTemplateSelector.getPushpinTextTemplates(i[i.length-1],null,null,null)))}t.getColor()&&(i=this._applyCustomPushpinColor(i,this._convertSDKColorToColor(t.getColor())))}}else i=this.baseMapTemplateSelector.getSDKLandmarkImageTemplates(t,this._map.getMercatorZoomLevel(),this._map.getMapOptions().liteMode);else{if(t.getTemplates)return t.getTemplates();t.getTemplate&&(i=[t.getTemplate()])}return i},n.prototype.dispose=function(){this._map=null;this.baseMapTemplateSelector=null;i._clearDisposables(this._disposables)},n.prototype._getMicroPoiTemplate=function(i,r){var u=this._map.getMapType(),f=r===4?n._microPoiSelectedColors:u.id===t.aerial?n._microPoiAerialColors:n._microPoiColors,e={records:[{centerX:0,centerY:0,radiusX:n._microPoiRadius,radiusY:n._microPoiRadius,vectorType:2,style:{fillStyle:f[i-1]}}],hotspotX:0,hotspotY:0,hitTest:1},o=new yt(e);return[o]},n.prototype._getTextAnchor=function(t,i){var r=t/2+n._pushpinTextAnchorOffset.x+i.x,u=n._pushpinTextAnchorOffset.y+i.y;return new p(r,u)},n.prototype._applyCustomPushpinColor=function(t,i){for(var u,r,f,o=[],e=0;e<t.length;e++){var s=t[e],l=s.getVectorImage(),h=l.records,c=[];for(u=0;u<h.length;u++)r=n._cloneObject(h[u]),r.vectorType===2&&(r.style.strokeStyle&&(f=r.style.strokeStyle.indexOf("#")>=0?1:0,r.style.strokeStyle=this._getUpdatedRecordColor(new nt(r.style.strokeStyle,f),i)),r.style.fillStyle&&(f=r.style.fillStyle.indexOf("#")>=0?1:0,r.style.fillStyle=this._getUpdatedRecordColor(new nt(r.style.fillStyle,f),i))),c.push(r);o.push(new yt({hitTest:1,records:c},s.getScale()))}return o},n.prototype._getUpdatedRecordColor=function(t,i){var r,f=t.alpha,u;return t.alpha=1,u=t.toRgba(),n._defaultPoiColorsRgba.indexOf(u)>=0?(r=i,r.alpha=f):n._defaultPoiLayerColorRgbaAlphas[u]&&(r=i,r.alpha=n._defaultPoiLayerColorRgbaAlphas[u]),t.alpha=f,r?r.toRgba():t.toRgba()},n.prototype._convertSDKColorToColor=function(n){var t,i;return n.toHex?new nt(n.toHex(),1):(t=document.createElement("div"),t.style.display="none",t.style.backgroundColor=n,document.body.appendChild(t),i=window.getComputedStyle(t).backgroundColor,document.body.removeChild(t),new nt(i,0))},n._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},n._pushpinColorIndex=1,n._pushpinTextAnchorOffset=new f(0,8),n._defaultPoiColorsRgba=["rgb(170,41,143)","rgb(211,72,191)","rgb(128,130,133)","rgb(109,110,113)",],n._defaultPoiLayerColorRgbaAlphas={"rgb(231,209,232)":.08,"rgb(107,64,103)":.3,"rgb(209,211,212)":.08},n._microPoiColors=["#cc7fbc","#78cec8","#65b765"],n._microPoiAerialColors=["#b252ae","#229499","#449158"],n._microPoiSelectedColors=["#93277f","#00afaa","#007500"],n._microPoiRadius=3,n._venueMapAreaLabelStyle={styleStatic:{font:"SegoeBing",fontSize:12,fontWeight:0,fontCaps:0,fontMinimumSize:1,pointLabelPlacementPreference:0,polygonFillPreference:0,verticalAlignment:1,fontGlow:!1,fontItalics:!1,fontOutlined:!1,fontUnderlined:!1,glowColor:"rgb(255,255,255)",glowSize:10,outlineWidth:2,strataStyle:{alpha:.3,fontSize:12},shieldLabelVisibility:2,secondaryFontSize:42,showBackground:!1},styleDynamic:{visible:!0,densityDistance:0,densityImportance:0,densityLodDelta:0,priority:0,fontColor:"rgb(51,51,51)",outlineColor:"rgba(255,255,255,0.6)",globalOrder:1103}},n}(),bi=function(){function n(n,t,i){var r,o,f,e,u;this.eventName=n;this.location=i.location;r=this.point=i.point;o=this.target=this.primitive=i.primitive;this.layer=i.layer;this.exclusiveHitTest=i.exclusiveHitTest;this._setTargetType(o);f=t.getRootElement().get_absolute_pos();this.pageX=r.x+f.x;this.pageY=r.y+f.y;e=t.getActualSize();u=i.originalArgs||{};this.getX=function(){return r.x-e.width/2};this.getY=function(){return r.y-e.height/2};["mousedown","mouseup","click","dblclick","rightclick"].indexOf(n)>=0&&(this.isPrimary=u.which===1,this.isSecondary=u.which===3);n==="mousewheel"&&(this.wheelDelta=u.wheelDelta)}return n.prototype._setTargetType=function(n){switch(!0){case n instanceof l:this.targetType="pushpin";break;case n instanceof d:this.targetType="polyline";break;case n instanceof w:this.targetType="polygon";break;default:this.targetType=null}},n}(),h;(function(n){n[n.control=0]="control";n[n.page=1]="page";n[n.viewport=2]="viewport"})(h||(h={}));var c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),l=function(n){function t(i,u){var e=this,f={},s,o;return u=u||{},f.icon=u.icon||t._defaultOptions.icon,f.anchor=u.anchor||t._defaultOptions.anchor,s=f.anchor?new p(f.anchor.x,f.anchor.y):null,f.title=typeof u.title=="string"?u.title:t._defaultOptions.title,f.subTitle=typeof u.subTitle=="string"?u.subTitle:t._defaultOptions.subTitle,f.text=typeof u.text=="string"?u.text:t._defaultOptions.text,o={id:"Pushpin_"+t._pushpinId++,collisionBehavior:2,title:f.title,subtitle:f.subTitle},o.iconText=f.text,e=n.call(this,i,o,null,s)||this,f.draggable=typeof u.draggable=="boolean"?u.draggable:t._defaultOptions.draggable,f.visible=typeof u.visible=="boolean"?u.visible:t._defaultOptions.visible,f.textOffset=u.textOffset||t._defaultOptions.textOffset,f.enableHoverStyle=typeof u.enableHoverStyle=="boolean"?u.enableHoverStyle:t._defaultOptions.enableHoverStyle,f.enableClickedStyle=typeof u.enableClickedStyle=="boolean"?u.enableClickedStyle:t._defaultOptions.enableClickedStyle,e.bucket=f.bucket=u.bucket||t.defaultPushpinBucketId,e.catId=f.catId=u.catId,e.isMicroPoi=f.isMicroPoi=u.isMicroPoi,e._options=f,e._updateDefaultStyle(),f.color=u.color||t._defaultOptions.color,f.cursor=u.cursor||t._defaultOptions.cursor,f.roundClickableArea=typeof u.roundClickableArea=="boolean"?u.roundClickableArea:t._defaultOptions.roundClickableArea,e._setImage(u.icon),e.changed=new r,e.changing=new r,e._state=2,e.stretchText=!1,e.revision=0,e}return c(t,n),t.prototype.getAnchor=function(){return this.anchor?new f(this.anchor.x,this.anchor.y):null},t.prototype.getDraggable=function(){return this._options.draggable},t.prototype.getHoverStyleEnabled=function(){return this._options.enableHoverStyle},t.prototype.getClickedStyleEnabled=function(){return this._options.enableClickedStyle},t.prototype.getColor=function(){return this._options.color},t.prototype.getIcon=function(){return this._options.icon},t.prototype.getRoundClickableArea=function(){return this._options.roundClickableArea},t.prototype.getText=function(){return this._options.text},t.prototype.getTextOffset=function(){return this._options.textOffset},t.prototype.getTitle=function(){return this._options.title},t.prototype.getSubTitle=function(){return this._options.subTitle},t.prototype.getVisible=function(){return this._options.visible},t.prototype.setLocation=function(t,i){var r=new s(this,"location",this.getLocation(),t);n.prototype.setLocation.call(this,t);i&&this.changing&&this.changing.hasHandlersRegistered()?this.changing.invoke(r):this.changed&&this.changed.invoke(r)},t.prototype.setOptions=function(n){var i=this._options,t={};t.visible=typeof n.visible=="boolean"?n.visible:i.visible;t.draggable=typeof n.draggable=="boolean"?n.draggable:i.draggable;t.icon=n.icon||i.icon;t.anchor=n.anchor||i.anchor;this.anchor=t.anchor?new p(t.anchor.x,t.anchor.y):null;t.title=typeof n.title=="string"?n.title:i.title;this.entity.title=t.title;t.subTitle=typeof n.subTitle=="string"?n.subTitle:i.subTitle;this.entity.subtitle=t.subTitle;t.text=typeof n.text=="string"?n.text:i.text;this.entity.iconText=t.text;t.textOffset=n.textOffset||i.textOffset;t.enableHoverStyle=typeof n.enableHoverStyle=="boolean"?n.enableHoverStyle:i.enableHoverStyle;t.enableClickedStyle=typeof n.enableClickedStyle=="boolean"?n.enableClickedStyle:i.enableClickedStyle;t.color=n.color||i.color;t.cursor=n.cursor||i.cursor;t.roundClickableArea=typeof n.roundClickableArea=="boolean"?n.roundClickableArea:i.roundClickableArea;this.bucket=t.bucket=n.bucket||i.bucket;this.catId=t.catId=n.catId||i.catId;this.isMicroPoi=t.isMicroPoi=typeof n.isMicroPoi=="boolean"?n.isMicroPoi:i.isMicroPoi;this._options=t;(n.icon||n.color||n.text)&&this._setImage(t.icon);this.revision++;this._updateDefaultStyle();this.changed&&this.changed.invoke(new s(this,"options",i,t))},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.dispose=function(){n.prototype.dispose.call(this);i._disposeEvents(this)},t.prototype._setImage=function(n){var t=this,r=this.getColor(),u;if(r instanceof pt&&(r=r.toRgba()),typeof n=="string"&&/<svg/i.test(n)&&!/^data:/i.test(n)&&(this.hasSvgText=n.indexOf("{text}")>=0,u=n.replace(/{color}/g,r||"").replace(/{text}/g,this.getText()||""),n="data:image/svg+xml;base64,"+window.btoa(u)),this.image=n,typeof this.image=="string"){var i=document.createElement("img"),f=function(n){var r,u,f,o;i.onload=null;window.clearTimeout(e);n?(i.style.visibility="hidden",r=document.createElement("div"),r.style.display="block",r.appendChild(i),document.body.appendChild(r),u=i.height,f=i.width,document.body.removeChild(r),i.height=u,i.width=f,t.anchor||t.setOptions({anchor:new p(i.width/2,i.height)}),t.changed&&t.changed.invoke(new s(t,"image",null,t.image))):(o=t.image,t.image=null,t.changed&&t.changed.invoke(new s(t,"image",o,t.image)))},e=window.setTimeout(function(){return f(!1)},5e3);i.onload=function(){f(!0)};i.src=this.image;this.image=i}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return!0},t.prototype.isMoveEnabled=function(){return this._options.draggable},t.prototype._hasTapEvents=function(){return this.getClickedStyleEnabled()||!!this.click||!!this.mouseup||!!this.mousedown},t.prototype._hasDoubleTapEvents=function(){return!!this.dblclick},t.prototype._layerHasTapEvents=function(){return!!(this.layer&&(this.layer.primitiveTapped&&this.layer.primitiveTapped.hasHandlersRegistered()||this.layer.primitivePointerPressed&&this.layer.primitivePointerPressed.hasHandlersRegistered()))},t.prototype._layerHasDoubleTapEvents=function(){return!!(this.layer&&this.layer.primitiveDoubleTapped&&this.layer.primitiveDoubleTapped.hasHandlersRegistered())},t.prototype.hasHoverEvents=function(){return!!this.mouseover||!!this.mouseover},t.prototype.hasInternalId=function(){return this.entity&&this.entity.id&&/^Pushpin_[1-9]([0-9])*$/i.test(this.entity.id)?!0:!1},t.prototype.getState=function(){return this._state},t.prototype.setState=function(n){if(this._state!==n){var i=this._state;this._state=n;n===4&&this.bucket===t.defaultPushpinBucketId?this.bucket=t.defaultClickedPushpinBucketId:n!==4&&this.bucket===t.defaultClickedPushpinBucketId&&(this.bucket=t.defaultPushpinBucketId);this.changed&&this.changed.invoke(new s(this,"state",i,n))}},t.prototype._updateDefaultStyle=function(){var n=this;this._options.enableClickedStyle!==!0||this._clickedStyleDisposable?this._options.enableClickedStyle===!1&&(this._clickedStyleDisposable&&(this._clickedStyleDisposable.dispose(),this._clickedStyleDisposable=null),this.setState(2)):(this.click||(this.click=new r),this._clickedStyleDisposable=this.click.add(function(){n._updateClickedStyle()}));this._options.enableHoverStyle!==!0||this._hoverStartStyleDisposable||this._hoverStartStyleDisposable?this._options.enableHoverStyle===!1&&(this._hoverStartStyleDisposable&&(this._hoverStartStyleDisposable.dispose(),this._hoverStartStyleDisposable=null),this._hoverEndStyleDisposable&&(this._hoverEndStyleDisposable.dispose(),this._hoverEndStyleDisposable=null),this.setState(2)):(this.mouseover||(this.mouseover=new r),this.mouseout||(this.mouseout=new r),this._hoverStartStyleDisposable=this.mouseover.add(function(){n._updateHoverStartStyle()}),this._hoverEndStyleDisposable=this.mouseout.add(function(){n._updateHoverStoppedStyle()}))},t.prototype._updateClickedStyle=function(){this.getState()===4?(this.setState(2),this.getHoverStyleEnabled()&&this._updateHoverStartStyle()):this.setState(4)},t.prototype._updateHoverStartStyle=function(){this.getState()===2&&this.setState(3)},t.prototype._updateHoverStoppedStyle=function(){this.getState()===3&&this.setState(2)},t._pushpinId=1,t._defaultOptions={anchor:null,draggable:!1,icon:null,visible:!0,title:null,subTitle:null,enableHoverStyle:!1,enableClickedStyle:!1,text:null,textOffset:new f(0,5),color:null,cursor:"pointer",roundClickableArea:!1},t.defaultPushpinBucketId="999999",t.defaultClickedPushpinBucketId="999998",t.areaLabelBucketId="999997.5",t}(ai),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),w=function(n){function t(i,u){var o=this,f,s;return u?(f={},f.fillColor=u.fillColor||t._defaultOptions.fillColor,f.strokeColor=u.strokeColor||t._defaultOptions.strokeColor,f.strokeDashArray=u.strokeDashArray||t._defaultOptions.strokeDashArray,f.strokeThickness=typeof u.strokeThickness=="number"?u.strokeThickness:t._defaultOptions.strokeThickness,f.secondaryStrokeColor=u.secondaryStrokeColor||t._defaultOptions.secondaryStrokeColor,f.secondaryStrokeThickness=typeof u.secondaryStrokeThickness=="number"?u.secondaryStrokeThickness:t._defaultOptions.secondaryStrokeThickness,f.visible=typeof u.visible=="boolean"?u.visible:t._defaultOptions.visible,f.generalizable=typeof u.generalizable=="boolean"?u.generalizable:t._defaultOptions.generalizable,f.cursor=u.cursor||t._defaultOptions.cursor):f=t._defaultOptions,o=n.call(this,i,null,null,f.generalizable)||this,o.changed=new r,o._options=f,s=new at({strokeStyle:e(f.strokeColor),fillStyle:e(f.fillColor),lineWidth:f.strokeThickness,secondaryStrokeStyle:e(f.secondaryStrokeColor),secondaryLineWidth:f.secondaryStrokeThickness,dashes:b(f.strokeDashArray),hitTest:1}),o.setTemplate(s),o}return c(t,n),t.prototype.getFillColor=function(){return this._options.fillColor},t.prototype.getLocations=function(){var n=this.getRings();return n.length>0?n[0]:[]},t.prototype.getStrokeColor=function(){return this._options.strokeColor},t.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},t.prototype.getStrokeThickness=function(){return this._options.strokeThickness},t.prototype.getVisible=function(){return this._options.visible},t.prototype.setLocations=function(n){this.setRings([n])},t.prototype.setOptions=function(n){var i=this._options,t={},r=this.getTemplate().getStyle(),f,u;if(t.strokeThickness=typeof n.strokeThickness=="number"?n.strokeThickness:i.strokeThickness,typeof n.strokeThickness=="number"&&(r.lineWidth=n.strokeThickness),t.strokeColor=n.strokeColor?n.strokeColor:i.strokeColor,n.strokeColor&&(r.strokeStyle=e(n.strokeColor)),t.strokeDashArray=n.strokeDashArray?n.strokeDashArray:i.strokeDashArray,n.strokeDashArray&&(r.dashes=b(n.strokeDashArray)),t.secondaryStrokeThickness=typeof n.secondaryStrokeThickness=="number"?n.secondaryStrokeThickness:i.secondaryStrokeThickness,typeof n.secondaryStrokeThickness=="number"&&(r.secondaryLineWidth=n.secondaryStrokeThickness),t.secondaryStrokeColor=n.secondaryStrokeColor?n.secondaryStrokeColor:i.secondaryStrokeColor,n.secondaryStrokeColor&&(r.secondaryStrokeStyle=e(n.secondaryStrokeColor)),t.fillColor=n.fillColor?n.fillColor:i.fillColor,n.fillColor&&(r.fillStyle=e(n.fillColor)),t.visible=typeof n.visible=="boolean"?n.visible:i.visible,t.generalizable=typeof n.generalizable=="boolean"?n.generalizable:i.generalizable,t.generalizable!==i.generalizable)for(f=this.geometry.rings,u=0;u<f.length;u++)f[u].generalizable=t.generalizable,f[u].generalizations=null;t.cursor=n.cursor||i.cursor;this._options=t;this.changed&&this.changed.invoke(new s(this,"options",i,t))},t.prototype.setRings=function(t){var i=this.getRings();n.prototype.setRings.call(this,t,this._options.generalizable);this.changed&&this.changed.invoke(new s(this,"rings",i,t))},t.prototype.toString=function(){throw"Not implemented";},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.getGeneralizable=function(){return this._options.generalizable},t.getDefaultStyle=function(){var n=t._defaultOptions;return{fillStyle:e(n.fillColor),strokeStyle:e(n.strokeColor),lineWidth:n.strokeThickness,dashes:b(n.strokeDashArray)}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return!0},t.prototype.dispose=function(){n.prototype.dispose.call(this);i._disposeEvents(this)},t.prototype._hasTapEvents=function(){return!!this.click||!!this.mouseup||!!this.mousedown},t.prototype._hasDoubleTapEvents=function(){return!!this.dblclick},t.prototype._layerHasTapEvents=function(){var n=this;return!!(n.layer&&(n.layer.primitiveTapped.hasHandlersRegistered()||n.layer.primitivePointerPressed.hasHandlersRegistered()))},t.prototype._layerHasDoubleTapEvents=function(){var n=this;return!!(n.layer&&n.layer.primitiveDoubleTapped.hasHandlersRegistered())},t.prototype.hasHoverEvents=function(){return!!this.mouseover||!!this.mouseover},t._defaultOptions={fillColor:"rgba(90, 255, 150, 0.4)",strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0},t._stylePropertiesDict={fillColor:"fillStyle",strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},t}(ci),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),d=function(n){function t(i,u){var o=this,f,s;return u?(f={},f.strokeColor=u.strokeColor||t._defaultOptions.strokeColor,f.strokeDashArray=u.strokeDashArray||t._defaultOptions.strokeDashArray,f.strokeThickness=typeof u.strokeThickness=="number"?u.strokeThickness:t._defaultOptions.strokeThickness,f.secondaryStrokeColor=u.secondaryStrokeColor||t._defaultOptions.secondaryStrokeColor,f.secondaryStrokeThickness=typeof u.secondaryStrokeThickness=="number"?u.secondaryStrokeThickness:t._defaultOptions.secondaryStrokeThickness,f.visible=typeof u.visible=="boolean"?u.visible:t._defaultOptions.visible,f.generalizable=typeof u.generalizable=="boolean"?u.generalizable:t._defaultOptions.generalizable,f.cursor=u.cursor||t._defaultOptions.cursor):f=t._defaultOptions,o=n.call(this,i,null,null,f.generalizable)||this,o.changed=new r,o._options=f,s=new at({strokeStyle:e(f.strokeColor),lineWidth:f.strokeThickness,secondaryStrokeStyle:e(f.secondaryStrokeColor),secondaryLineWidth:f.secondaryStrokeThickness,dashes:b(f.strokeDashArray),hitTest:1}),o.setTemplate(s),o}return c(t,n),t.prototype.getStrokeColor=function(){return this._options.strokeColor},t.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},t.prototype.getStrokeThickness=function(){return this._options.strokeThickness},t.prototype.getVisible=function(){return this._options.visible},t.prototype.setLocations=function(t){var i=this.getLocations();n.prototype.setLine.call(this,t,this.getGeneralizable());this.changed&&this.changed.invoke(new s(this,"locations",i,t))},t.prototype.setOptions=function(n){var i=this._options,t={},r=this.getTemplate().getStyle();t.strokeThickness=typeof n.strokeThickness=="number"?n.strokeThickness:i.strokeThickness;typeof n.strokeThickness=="number"&&(r.lineWidth=n.strokeThickness);t.strokeColor=n.strokeColor?n.strokeColor:i.strokeColor;n.strokeColor&&(r.strokeStyle=e(n.strokeColor));t.strokeDashArray=n.strokeDashArray?n.strokeDashArray:i.strokeDashArray;n.strokeDashArray&&(r.dashes=b(n.strokeDashArray));t.secondaryStrokeThickness=typeof n.secondaryStrokeThickness=="number"?n.secondaryStrokeThickness:i.secondaryStrokeThickness;typeof n.secondaryStrokeThickness=="number"&&(r.secondaryLineWidth=n.secondaryStrokeThickness);t.secondaryStrokeColor=n.secondaryStrokeColor?n.secondaryStrokeColor:i.secondaryStrokeColor;n.secondaryStrokeColor&&(r.secondaryStrokeStyle=e(n.secondaryStrokeColor));t.visible=typeof n.visible=="boolean"?n.visible:i.visible;t.generalizable=typeof n.generalizable=="boolean"?n.generalizable:i.generalizable;t.generalizable!==i.generalizable&&(this.geometry.generalizable=t.generalizable,this.geometry.generalizations=null);t.cursor=n.cursor||i.cursor;this._options=t;this.changed&&this.changed.invoke(new s(this,"options",i,t))},t.prototype.toString=function(){throw"Not implemented";},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.getGeneralizable=function(){return this._options.generalizable},t.getDefaultStyle=function(){var n=t._defaultOptions;return{strokeStyle:e(n.strokeColor),lineWidth:n.strokeThickness,dashes:b(n.strokeDashArray)}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return!0},t.prototype.dispose=function(){n.prototype.dispose.call(this);i._disposeEvents(this)},t.prototype._hasTapEvents=function(){return!!this.click||!!this.mouseup||!!this.mousedown},t.prototype._hasDoubleTapEvents=function(){return!!this.dblclick},t.prototype._layerHasTapEvents=function(){var n=this;return!!(n.layer&&(n.layer.primitiveTapped.hasHandlersRegistered()||n.layer.primitivePointerPressed.hasHandlersRegistered()))},t.prototype._layerHasDoubleTapEvents=function(){var n=this;return!!(n.layer&&n.layer.primitiveDoubleTapped.hasHandlersRegistered())},t.prototype.hasHoverEvents=function(){return!!this.mouseover||!!this.mouseover},t._defaultOptions={strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0},t._stylePropertiesDict={strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},t}(li);var ki=function(){function n(){}return n.getColor=function(n){return n?"rgba("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+", 0.5)":"#"+Math.floor(Math.random()*16777215).toString(16)},n.getLocations=function(n,t){var i,r;if((!n||n<=0)&&(n=1),t=this._processLocationRect(t),!n||n<=1)return this._getRandomLocation(t);for(i=[],r=0;r<n;r++)i.push(this._getRandomLocation(t));return i},n.getPushpins=function(t,i,r){function s(t,i,r){return i&&r&&(i.title=n.getText(5)),new l(n._getRandomLocation(t),i)}var u,f,e,o;if((!t||t<=0)&&(t=1),i=this._processLocationRect(i),u=r,f=u&&u.title==="*random*",!t||t<=1)return s(i,u,f);for(e=[],o=0;o<t;o++)e.push(s(i,u,f));return e},n.getPolylines=function(t,i,r,u,f){var e,o,s,h,c;if((!t||t<=0)&&(t=1),r&&r<=1&&(r=2),(!u||u<=0)&&(u=.1),i=this._processLocationRect(i),e=Math.min(i.width/2,i.height)*u,i.width-=e*2,i.height-=e*2,e*=111e3,o=r,!t||t<=1)return r||(o=Math.ceil(Math.random()*7+3)),s=f?f:{strokeColor:n.getColor(!0),strokeThickness:Math.ceil(Math.random()*3+1)},new d(this._generateSimplePolygonPoints(this._getRandomLocation(i),e,o),s);for(h=[],c=0;c<t;c++)r||(o=Math.ceil(Math.random()*7+3)),s=f?f:{strokeColor:n.getColor(!0),strokeThickness:Math.ceil(Math.random()*3+1)},h.push(new d(this._generateSimplePolygonPoints(this._getRandomLocation(i),e,o),s));return h},n.getPolygons=function(t,i,r,u,f,e){var o,s,h,c,l;if((!t||t<=0)&&(t=1),r&&r<=2&&(r=3),(!u||u<=0)&&(u=.1),i=this._processLocationRect(i),o=Math.min(i.width/2,i.height)*u,i.width-=o*2,i.height-=o*2,o*=111e3,s=r,!t||t<=1)return r||(s=Math.ceil(Math.random()*7+3)),h=f?f:{strokeColor:n.getColor(!0),fillColor:n.getColor(!0),strokeThickness:Math.ceil(Math.random()*3+1)},e?new w(this._generateHoledPolygonPoints(this._getRandomLocation(i),o,s),h):new w(this._generateSimplePolygonPoints(this._getRandomLocation(i),o,s),h);for(c=[],l=0;l<t;l++)r||(s=Math.ceil(Math.random()*7+3)),h=f?f:{strokeColor:n.getColor(!0),fillColor:n.getColor(!0),strokeThickness:Math.ceil(Math.random()*3+1)},e?c.push(new w(this._generateHoledPolygonPoints(this._getRandomLocation(i),o,s),h)):c.push(new w(this._generateSimplePolygonPoints(this._getRandomLocation(i),o,s),h));return c},n.getText=function(t){var i=n._lipsum,f=i[Math.floor(Math.random()*i.length)],r=f.split(" "),u;return t=Math.min(t,r.length),u=Math.ceil(Math.random()*t+1),r.slice(0,u).join(" ")},n._processLocationRect=function(n){return n&&n instanceof ot?n:new ot(new a(0,0),360,170)},n._getRandomLocation=function(n){var t=Math.random()*n.height+n.getSouth(),i=a.normalizeLongitude(Math.random()*n.width+n.getWest());return new a(t,i)},n._generateSimplePolygonPoints=function(n,t,i){for(var u=[],f=360/i,e=360*Math.random(),r=i;r>0;r--)u.push(this._calculateCoord(n,(r*f+e)%360,t*Math.max(Math.random(),.3)));return u},n._generateHoledPolygonPoints=function(n,t,i){for(var e=[],o=[],s=360/i,h=360*Math.random(),r,u,f=i;f>0;f--)u=t*Math.max(Math.random(),.3),r=(f*s+h)%360,e.push(this._calculateCoord(n,r,u)),o.push(this._calculateCoord(n,r,u*Math.random()));return[e,o.reverse()]},n._calculateCoord=function(n,t,i){var r=n.latitude*Math.PI/180,e=n.longitude*Math.PI/180,u=i/6378100,f=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(t*Math.PI/180)),o=e+Math.atan2(Math.sin(t*Math.PI/180)*Math.sin(u)*Math.cos(r),Math.cos(u)-Math.sin(r)*Math.sin(f));return new a(f*180/Math.PI,o*180/Math.PI)},n._lipsum=["Lorem ipsum dolor sit amet","Tamquam invidunt praesent nam ne","Ut errem doming eos","An erat fuisset disputando sed","Sea in omittantur voluptatibus","Cibo aperiri eam ei","Qui at nemore abhorreant","Eripuit labores eu vel","Id sea hinc offendit","An liber semper reprimique vix","Te mei impetus accumsan","Solet aliquid eos no","No nec iriure argumentum","Sit an labore albucius euripidis","Nec cu ancillae accommodare","No vel quando scripta mnesarchum","Sea veritus necessitatibus ea","Ut sea modo omnes indoctum","Modus iisque voluptatibus te usu","Nulla ridens pertinacia qui ne","Ei aeque oblique electram has","Vim eu odio delicata","An fastidii suscipit vel","Ne malorum volutpat tractatos eum","Vocibus disputationi nec et","Nam cibo iudico ut","Ius ea possit eligendi","Ei civibus menandri posidonium has","Esse voluptua pri ut","At petentium interpretaris pri","Te natum iudico discere est","Enim libris id est","Ea quidam corpora reprehendunt vix","Est eu habeo nulla ullamcorper","No vel mucius labore consequuntur","Quodsi pertinax eu eam","Sensibus honestatis per ne","Est ex eruditi offendit probatus","Vix scaevola splendide assentior id","Dico iriure admodum sed ne","Munere vocent albucius est ne"],n}(),ut=function(){function n(t){this._options={beneathLabels:n._defaultOptions.beneathLabels,showInBirdseye:n._defaultOptions.showInBirdseye};t&&(typeof t.beneathLabels=="boolean"&&(this._options.beneathLabels=t.beneathLabels),typeof t.showInBirdseye=="boolean"&&(this._options.showInBirdseye=t.showInBirdseye))}return n.prototype.getHtmlElement=function(){return this._htmlElement},n.prototype.setHtmlElement=function(n){this._map&&(n&&this._insertHtmlElement(n),this._htmlElement&&this._parentElement.removeChild(this._htmlElement));this._htmlElement=n},n.prototype.getOptions=function(){return this._options},n.prototype.onAdd=function(){},n.prototype.onRemove=function(){},n.prototype.onLoad=function(){},n.prototype.attachMap=function(n){var t=this;if(this._map)throw"This custom overlay is already attached to an existing map";n&&(this.onAdd(),this._map=n,this._map.getV8Map().getLabelController()?(this._insertHtmlElement(this._htmlElement),this._onMapTypeChanged=this._map.getV8Map().mapTypeChanged.add(function(){t._map&&t._map.getV8Map().getFrameManager().frameRendered.addOne(function(){t._insertHtmlElement(t._htmlElement)})}),this.onLoad()):this._map.getV8Map().labelControllerLoaded.addOne(function(){t._insertHtmlElement(t._htmlElement);t.onLoad()}))},n.prototype.detachMap=function(n){if(this._map!==n)throw"Cannot remove custom overlay from this map since it's attached to another map instance";this._htmlElement&&this._parentElement&&this._parentElement.removeChild(this._htmlElement);this._onMapTypeChanged&&this._onMapTypeChanged.dispose();this._map=null;this._parentElement=null;this.onRemove()},n.prototype.getMap=function(){return this._map},n.prototype._insertHtmlElement=function(n){if(this._map&&this._map.getImageryId()!=="Streetside"){var t=this._map.getV8Map().getRootElement().select(".labelCanvas")[0];this._parentElement=t.parentElement;this._options.beneathLabels?this._parentElement.insertBefore(n,t):this._parentElement.appendChild(n);this._stopEventsPropagation()}},n.prototype._stopEventsPropagation=function(){if(this._htmlElement){var n={stopPropagation:!0};i._defineJSEventForDomEvent(o(this._htmlElement),"mousemove",n);i._defineJSEventForDomEvent(o(this._htmlElement),"mousedown",n);i._defineJSEventForDomEvent(o(this._htmlElement),"mouseup",n);i._defineJSEventForDomEvent(o(this._htmlElement),"click",n);i._defineJSEventForDomEvent(o(this._htmlElement),"dblclick",n);i._defineJSEventForDomEvent(o(this._htmlElement),"contextmenu",n);i._defineJSEventForDomEvent(o(this._htmlElement),"touchmove",n);i._defineJSEventForDomEvent(o(this._htmlElement),"touchstart",n);i._defineJSEventForDomEvent(o(this._htmlElement),"touchend",n);i._defineJSEventForDomEvent(o(this._htmlElement),"keydown",n);i._defineJSEventForDomEvent(o(this._htmlElement),"keyup",n)}},n._defaultOptions={beneathLabels:!0,showInBirdseye:!1},n}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),di=function(n){function t(t){var i=n.call(this,{beneathLabels:typeof t.beneathLabels=="boolean"?t.beneathLabels:!0})||this;return i._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0},i.setOptions(t),i}return c(t,n),t.prototype.clear=function(){this._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0};this.setHtmlElement(null)},t.prototype.getBackgroundColor=function(){return this._groundOverlayOptions.backgroundColor},t.prototype.getBounds=function(){return this._groundOverlayOptions.bounds},t.prototype.getImageUrl=function(){return this._groundOverlayOptions.imageUrl},t.prototype.getOpacity=function(){return this._groundOverlayOptions.opacity},t.prototype.getRotation=function(){return this._groundOverlayOptions.rotation},t.prototype.getVisible=function(){return this._groundOverlayOptions.visible},t.prototype.setOptions=function(n){n&&typeof n.beneathLabels=="boolean"&&(this._groundOverlayOptions.beneathLabels=n.beneathLabels);typeof n.backgroundColor!="undefined"&&(this._groundOverlayOptions.backgroundColor=n.backgroundColor,this._img&&(this._img.style.backgroundColor=typeof this._groundOverlayOptions.backgroundColor=="string"?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba()));typeof n.opacity=="number"&&(this._groundOverlayOptions.opacity=n.opacity,this._img&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString()));typeof n.rotation=="number"&&(this._groundOverlayOptions.rotation=n.rotation,this._rotateGroundOverlay());n.bounds instanceof ot&&(this._groundOverlayOptions.bounds=n.bounds);typeof n.imageUrl!="undefined"&&(this._groundOverlayOptions.imageUrl=n.imageUrl,this._loadGroundOverlayImage());this.setVisible(n.visible);this._repositionGroundOverlay()},t.prototype.setVisible=function(n){typeof n=="boolean"&&(this._groundOverlayOptions.visible=n,this._img&&(n?(this._img.style.display="",this._repositionGroundOverlay()):this._img.style.display="none"))},t.prototype.onLoad=function(){var n=this;this._repositionGroundOverlay();y.addHandler(this.getMap(),"viewchange",function(){n._repositionGroundOverlay()});y.addHandler(this.getMap(),"mapresize",function(){n._repositionGroundOverlay()});y.addHandler(this.getMap(),"mapsetview",function(){n._repositionGroundOverlay()})},t.prototype.onRemove=function(){},t.prototype._loadGroundOverlayImage=function(){this._groundOverlayOptions.imageUrl?(this._img=document.createElement("img"),this._img.src=this._groundOverlayOptions.imageUrl,this._img.style.width="100%",this._img.style.height="100%",this._img.style.position="absolute",this._img.style.display=this._groundOverlayOptions.visible?"":"none",this._groundOverlayOptions.backgroundColor&&(this._img.style.backgroundColor=typeof this._groundOverlayOptions.backgroundColor=="string"?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba()),typeof this._groundOverlayOptions.opacity=="number"&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString()),this._rotateGroundOverlay(),this.setHtmlElement(this._img)):this.setHtmlElement(null)},t.prototype._rotateGroundOverlay=function(){var t,n;this._img&&(t=this._groundOverlayOptions.rotation,t||(t=0),n="rotate("+t+"deg)",this._img.style["-webkit-transform"]=n,this._img.style["-moz-transform"]=n,this._img.style["-ms-transform"]=n,this._img.style["-o-transform"]=n,this._img.style.transform=n)},t.prototype._repositionGroundOverlay=function(){var i=this.getMap(),n,t;i&&this._img&&this._groundOverlayOptions.bounds&&this._groundOverlayOptions.visible&&(n=i.tryLocationToPixel(this._groundOverlayOptions.bounds.getNorthwest(),Microsoft.Maps.PixelReference.control),t=i.tryLocationToPixel(this._groundOverlayOptions.bounds.getSoutheast(),Microsoft.Maps.PixelReference.control),this._img.style.left=n.x+"px",this._img.style.top=n.y+"px",this._img.style.width=t.x-n.x+"px",this._img.style.width=t.x-n.x+"px",this._img.style.height=t.y-n.y+"px")},t}(ut),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),gi=function(n){function t(i){var u=n.call(this)||this;return u._layerOptions={visible:t._defaultLayerOptions.visible,frameRate:t._defaultLayerOptions.frameRate,mercator:t._defaultLayerOptions.mercator,maxTotalLoadTime:t._defaultLayerOptions.maxTotalLoadTime,loadingScreen:t._defaultLayerOptions.loadingScreen,autoPlay:t._defaultLayerOptions.autoPlay},u._disposables=[],u._primers=[],u._currentFrameIndex=0,u._animationState=0,u.preLoadStarted=new r,u.preLoadEnded=new r,u.onFrameLoaded=new r,u.setOptions(i),u}return c(t,n),t.prototype.onAdd=function(){var n=document.createElement("div");n.style.position="absolute";this.setHtmlElement(n)},t.prototype.onRemove=function(){var t=this._layerOptions.loadingScreen,n;for(t.getMap()&&t.detachMap(t.getMap()),this._animationState===1&&this.stop(),n=0;n<this._disposables.length;n++)this._disposables[n].dispose()},t.prototype.onLoad=function(){var n=this,t=this._map.getV8Map().getActualSize(),i;this._htmlElement.style.height=t.height+"px";this._htmlElement.style.width=t.width+"px";i=this._map.getV8Map().actualSizeChanged.add(function(){n._removeAllTiles();var t=n._map.getV8Map().getActualSize();n._htmlElement.style.height=t.height+"px";n._htmlElement.style.width=t.width+"px";n._preLoadAllTiles()});this._disposables.push(i);this._disposables.push(this._map.viewchangestart.add(function(){n._removeAllTiles()}));this._disposables.push(this._map.viewchangeend.add(function(){n._preLoadAllTiles()}));this._preLoadAllTiles()},t.prototype.setOptions=function(n){if(n){if(typeof n.frameRate=="number"&&(this._layerOptions.frameRate=n.frameRate,this._animationState===1&&(this.pause(),this.play())),this._layerOptions.maxTotalLoadTime=typeof n.maxTotalLoadTime=="number"?n.maxTotalLoadTime:this._layerOptions.maxTotalLoadTime,this._layerOptions.visible=typeof n.visible=="boolean"?n.visible:this._layerOptions.visible,this._map&&(this._layerOptions.visible?(this._toggleFrameVisibility(this._currentFrameIndex,this._animationState!==3),this._animationState===1&&this.play()):(this._clearAnimation(),this._toggleFrameVisibility(this._currentFrameIndex,!1))),n.mercator&&(this._layerOptions.mercator=n.mercator,this._map&&(this._removeAllTiles(),this._preLoadAllTiles())),n.loadingScreen){var t=this._layerOptions.loadingScreen.getMap();t&&this._layerOptions.loadingScreen.detachMap(t);this._layerOptions.loadingScreen=n.loadingScreen}this._layerOptions.autoPlay=typeof n.autoPlay=="boolean"?n.autoPlay:this._layerOptions.autoPlay;typeof n.autoPlay=="boolean"&&(this._animationState=this._layerOptions.autoPlay?0:2)}},t.prototype.getTileSources=function(){return this._layerOptions.mercator},t.prototype.getFrameRate=function(){return this._layerOptions.frameRate},t.prototype.getMaxTotalLoadTime=function(){return this._layerOptions.maxTotalLoadTime},t.prototype.getVisible=function(){return this._layerOptions.visible},t.prototype.getLoadingScreen=function(){return this._layerOptions.loadingScreen},t.prototype.getAnimationState=function(){return this._animationState},t.prototype.stop=function(){this._animationState=3;this._clearAnimation();this._map&&this._toggleFrameVisibility(this._currentFrameIndex,!1);this._currentFrameIndex=0},t.prototype.pause=function(){this._animationState=2;this._clearAnimation()},t.prototype.play=function(){var n=this;this._clearAnimation();this._animationState=1;this._map&&(this._toggleFrameVisibility(this._currentFrameIndex,!0),this._animation=setInterval(function(){if(n._map&&n._map.getImageryId()!=="Streetside"){var t=n._currentFrameIndex;n._currentFrameIndex=n._currentFrameIndex+1===n._primers.length?0:n._currentFrameIndex+1;n._toggleFrameVisibility(n._currentFrameIndex,!0);n._toggleFrameVisibility(t,!1)}},this._layerOptions.frameRate))},t.prototype._removeAllTiles=function(){for(this._clearAnimation();this._htmlElement&&this._htmlElement.firstChild;)this._htmlElement.removeChild(this._htmlElement.firstChild)},t.prototype._preLoadAllTiles=function(){var u,n,o,s,f;this.preLoadStarted.invoke();this._layerOptions.loadingScreen.getMap()||this._layerOptions.loadingScreen.attachMap(this._map);this._primers=[];var h=this._map.getCenter().latitude,c=this._map.getCenter().longitude,e=this._map.getZoom(),r=this._layerOptions.mercator;for(u=0;u<r.length;u++)(n=document.createElement("div"),n.className=t._layerFrameClassName,n.style.visibility="hidden",n.style.position="absolute",n.style.height="100%",n.style.width="100%",this._htmlElement.appendChild(n),typeof r[u].getMaxZoom()=="number"&&e>r[u].getMaxZoom()||typeof r[u].getMinZoom()=="number"&&e<r[u].getMinZoom())||(o=r[0].getBounds()&&r[0].getBounds().bounds,i._isFeatureEnabled("tilePrimerV2")?(f=Microsoft.Maps.GlobalConfig.dynamicProperties,s=new MapsTilePrimerV2.Primer(n,f.market,f.isGeopolUserRegion&&f.userRegion?f.userRegion:null,h.toString(),c.toString(),e,o,null,null,null,null,r[u].getUriConstructor(),null,null,null,null,!0)):s=new g.Primer(n,Microsoft.Maps,{centerPointLocation:{latitude:h,longitude:c},zoom:e,tileRequestBounds:o},r[u].getUriConstructor(),null,"",null),this._primers.push(s),n.firstElementChild.style.zIndex="auto");this._checkPreLoadTilesComplete()},t.prototype._checkPreLoadTilesComplete=function(){var n=this,t=function(){clearInterval(i);clearTimeout(r);n._layerOptions.visible&&n._animationState!==3&&n._map&&n._toggleFrameVisibility(n._currentFrameIndex,!0);var t=n._layerOptions.loadingScreen;t.getMap()&&t.detachMap(t.getMap());n.preLoadEnded.invoke();n._layerOptions.visible&&n._animationState<2&&n._map&&n.play()},i=setInterval(function(){for(var r=!0,i=0;i<n._primers.length;i++)if(!n._primers[i].isTileLoadingCompleted()){r=!1;break}r&&t()},500),r=setTimeout(function(){t()},this._layerOptions.maxTotalLoadTime)},t.prototype._clearAnimation=function(){this._animation&&(clearInterval(this._animation),this._animation=null)},t.prototype._toggleFrameVisibility=function(n,i){if(this._htmlElement){var r=this._htmlElement.querySelectorAll("."+t._layerFrameClassName);r.item(n)&&(r.item(n).style.visibility=i?"visible":"hidden",i&&this.onFrameLoaded.invoke({index:this._currentFrameIndex,animatedTileLayer:this}))}},t._createDefaultLoadingScreen=function(){var n=new ut({beneathLabels:!1}),t;return n.onAdd=function(){if(!n.getHtmlElement()){var t=document.createElement("div");t.innerText="Loading tile animation...";t.style.position="absolute";t.style.backgroundColor="rgba(235, 233, 226, 0.75)";t.style.textAlign="center";t.style.verticalAlign="middle";n.setHtmlElement(t)}},n.onLoad=function(){var i=n.getMap().getV8Map().getActualSize();n.getHtmlElement().style.height=i.height+"px";n.getHtmlElement().style.width=i.width+"px";n.getHtmlElement().style.lineHeight=i.height+"px";t=n.getMap().getV8Map().actualSizeChanged.add(function(){var t=n.getMap().getV8Map().getActualSize();n.getHtmlElement().style.height=t.height+"px";n.getHtmlElement().style.width=t.width+"px";n.getHtmlElement().style.lineHeight=i.height+"px"})},n.onRemove=function(){t.dispose&&t.dispose()},n},t._defaultLayerOptions={visible:!0,frameRate:1e3,mercator:null,maxTotalLoadTime:15e3,loadingScreen:t._createDefaultLoadingScreen(),autoPlay:!0},t._layerFrameClassName="layerFrame",t}(ut),g;(function(n){var i=-85.05112878,r=85.05112878,e=-180,o=180,t=256,s=48,h=128,c="en-US",l=180/Math.PI,u=Math.PI/180,f=6378137,a=2*Math.PI*f,v=function(){function n(n,i,r,u,f,e,o){var l,s,h,a;if(this._tileFormat=u,this._width=n.offsetWidth,this._height=n.offsetHeight,this._parentDiv=n,this._tilesLoaded=0,this._findBestMapViewFromLocationInfo(r),l=Math.floor(r.zoom),this._zoom=Math.max(3,l),this._maxTileCoordinate=Math.pow(2,this._zoom)-1,this._tileSize=t,this._globalNamespace=i,this._globalConfig=i.GlobalConfig,!this._globalConfig.isMapsVertical&&r.tileRequestBounds&&i.LocationRect&&(this._tileRequestLocRect=i.LocationRect.fromEdges(r.tileRequestBounds[0],r.tileRequestBounds[3],r.tileRequestBounds[2],r.tileRequestBounds[1])),this._centerTile=this._latlongToPixelXY(r.centerPointLocation.latitude,r.centerPointLocation.longitude,this._zoom),this._centerTileX=this._centerTile.x/this._tileSize,this._centerTileY=this._centerTile.y/this._tileSize,this._centerOffset={x:-(this._centerTile.x%this._tileSize),y:-(this._centerTile.y%this._tileSize)},this._perf=f,this._centerOffset.x+=this._width/2,this._centerOffset.y+=this._height/2,this._mkt=c,this._tileDomain=e,this._globalConfig&&this._globalConfig.dynamicProperties&&(s=this._globalConfig.dynamicProperties.uiLanguage,h=this._globalConfig.dynamicProperties.userRegion,s&&(this._mkt=s),h&&(this._userRegion=h)),this._tileFormat)a=new RegExp("amp;","g"),this._tileFormat=this._tileFormat.replace(a,""),window.location.href.indexOf("testhttp2")>-1?(this._tileFormat=this._tileFormat.replace("http://","https://"),this._tileFormat=this._tileFormat.replace("{domain}","testdynamic-tiles.virtualearth.net")):this._tileFormat=this._tileFormat.replace("{domain}",this._tileDomain),o?this._tileFormat=this._tileFormat.replace("{eid}",o):(this._tileFormat=this._tileFormat.replace("&eid={eid}&hc=008200",""),this._tileFormat=this._tileFormat.replace("&eid={eid}&hc=52b573",""),this._tileFormat=this._tileFormat.replace("G,E","G"));else return;this._tileContainer=document.createElement("div");this._tileContainer.style.cssText="position:relative;overflow:hidden;z-index:1000;width:"+this._width+"px;height:"+this._height+"px";this._parentDiv.appendChild(this._tileContainer);this._addTiles()}return n.prototype.unWrap=function(){this._tileContainer&&this._parentDiv&&this._parentDiv.removeChild(this._tileContainer)},n.prototype._findBestMapViewFromLocationInfo=function(t){var i=null,r=null,u=null,f=this._width,e=this._height,o,s,h;if(t.viewportPadding){var c=t.viewportPadding.left,l=t.viewportPadding.top,y=this._width-t.viewportPadding.right,p=this._height-t.viewportPadding.bottom;f=y-c;e=p-l;r=c+f/2;u=l+e/2}if(t.bounds&&t.bounds.length==4?(o={latitude:t.bounds[0],longitude:t.bounds[1]},s={latitude:t.bounds[2],longitude:t.bounds[3]},i=n.accumulate([o,s])):t.locations&&t.locations.length>0&&(i=n.accumulate(t.locations)),i){var o={latitude:i[0],longitude:i[1]},w={latitude:i[0],longitude:i[3]},b={latitude:i[2],longitude:i[1]},s={latitude:i[2],longitude:i[3]},k={latitude:i[0],longitude:0},d={latitude:i[2],longitude:0},a={latitude:(i[2]+i[0])/2,longitude:(i[1]+i[3])/2},g=n._greatCircleDistance(o,w),nt=n._greatCircleDistance(b,s),tt=Math.max(g,nt),it=n._greatCircleDistance(k,d),rt=tt/f,ut=it/e,v=Math.max(rt,ut),ft=v!==0?n._getZoomFromMetersPerPixel(a.latitude,v):16;t.zoom=ft;t.centerPointLocation=a}h=null;r&&u&&(h=this._getAdjustedLocationAligningToGivenViewportCenter(t.zoom,t.centerPointLocation,r,u));t.centerPointLocation=h||t.centerPointLocation},n.prototype._addTile=function(n,t){var i=this,r=document.createElement("img"),f=function(){r.onload=r.onerror=r.onabort=null;window.clearTimeout(e);++i._tilesLoaded===i._tileCount&&(i._perf&&(i._perf.PPLT=(new Date).getTime()-i._perf.PPLT,typeof performance!="undefined"&&performance.now&&(i._perf.TPPLT=performance.now())),i._globalNamespace&&i._globalConfig.isMapsVertical&&i._globalNamespace.logger.logObject({feature:"BS",action:"PR_FIN",TS:Date.now()-i._globalNamespace.StartTicker},_G.IG,!0))},e=window.setTimeout(function(){return f()},5e3),o=n.charAt(n.length-1),u;r.onload=function(){return f()};r.onerror=r.onabort=function(){return f()};u=this._tileFormat.replace("{quadkey}",n).replace("{x}",Math.floor(this._tileX).toString()).replace("{y}",Math.floor(this._tileY).toString()).replace("{zoom}",this._zoom.toString()).replace("{bbox}",this._getWMSBoundsString(n)).replace("{subdomain}",(parseInt(o)%2).toString()).replace("{mkt}",this._mkt);u=this._userRegion&&this._globalConfig.dynamicProperties.isGeopolUserRegion?u.replace(/{ur}/,this._userRegion):u.replace(/&ur={ur}/,"");r.src=u;r.style.cssText="position:absolute;top:"+t.y+"px;left:"+t.x+"px";this._tileContainer.appendChild(r)},n.prototype.isTileLoadingCompleted=function(){return this._tilesLoaded===this._tileCount},n.prototype._addTiles=function(){var t,n;for(this._tileX=this._centerTileX,this._tileY=this._centerTileY,this._offset=this._centerOffset,this._direction=0,this._movesLeft=1,this._step=1,t=0,this._tileCount=0;t<h&&this._tileCount<s;t++)this._isVisible(this._offset)&&(n=this._getQuadKey(),n&&this._isTileInRequestBounds(n)&&(this._addTile(n,this._offset),this._tileCount++)),this._incrementSpiral()},n.prototype._getQuadKey=function(){var i,n,t,r;if(this._tileY<0||this._tileY>this._maxTileCoordinate)return null;for(i="",n=this._zoom;n>0;n--)t=0,r=1<<n-1,(this._tileX&r)!=0&&t++,(this._tileY&r)!=0&&(t+=2),i+=t;return i},n.prototype._isVisible=function(n){return n.y>-this._tileSize&&n.y<this._height&&n.x>-this._tileSize&&n.x<this._width},n.prototype._incrementSpiral=function(){switch(this._direction){case 0:this._tileX++;this._offset.x+=this._tileSize;break;case 1:this._tileY--;this._offset.y-=this._tileSize;break;case 2:this._tileX--;this._offset.x-=this._tileSize;break;case 3:this._tileY++;this._offset.y+=this._tileSize}this._tileX>this._maxTileCoordinate?this._tileX=0:this._tileX<0&&(this._tileX=this._maxTileCoordinate);this._movesLeft--;this._movesLeft<=0&&(this._movesLeft=Math.floor(this._step+=.5),++this._direction>3&&(this._direction=0))},n.prototype._latlongToPixelXY=function(n,t,u){var h=this._median(n,i,r),c=this._median(t,e,o),l=(c+180)/360,s=Math.sin(h*Math.PI/180),a=.5-Math.log((1+s)/(1-s))/(4*Math.PI),f=this._tileSize<<u;return{x:this._median(l*f+.5,0,f-1),y:this._median(a*f+.5,0,f-1)}},n.prototype._isTileInRequestBounds=function(n){var t=!0,i,r;return this._tileRequestLocRect&&this._globalNamespace.PyramidTileId&&this._globalNamespace.LocationRect&&this._globalNamespace.MercatorCubeCrs&&(i=this._globalNamespace.PyramidTileId.fromQuadKey(n,this._tileSize,this._tileSize,this._globalNamespace.MercatorCubeCrs.instance),r=this._globalNamespace.LocationRect.fromRegionId(i),t=this._tileRequestLocRect.intersects(r)),t},n.prototype._getWMSBoundsString=function(n){var i="",r,t;return this._globalNamespace.PyramidTileId&&this._globalNamespace.LocationRect&&this._globalNamespace.MercatorCubeCrs&&(r=this._globalNamespace.PyramidTileId.fromQuadKey(n,this._tileSize,this._tileSize,this._globalNamespace.MercatorCubeCrs.instance),t=this._globalNamespace.LocationRect.fromRegionId(r),i=t.getWest()+","+t.getSouth()+","+t.getEast()+","+t.getNorth()),i},n.prototype._median=function(n,t,i){return Math.min(Math.max(n,t),i)},n._greatCircleDistance=function(t,i){var r=n._degreesToRadians(i.latitude),u=n._degreesToRadians(t.latitude),s=n._degreesToRadians(i.longitude),h=n._degreesToRadians(t.longitude),c=Math.abs(r-u),l=Math.abs(s-h),e=Math.sin(c/2),o=Math.sin(l/2),a=2*Math.asin(Math.sqrt(e*e+Math.cos(u)*Math.cos(r)*o*o));return f*a},n._degreesToRadians=function(n){return n*u},n.accumulate=function(t){for(var i,r=0;r<t.length;r++)i?(i[0]=Math.max(i[0],t[r].latitude),i[1]=Math.min(i[1],t[r].longitude),i[2]=Math.min(i[2],t[r].latitude),i[3]=Math.max(i[3],t[r].longitude)):i=[t[r].latitude,t[r].longitude,t[r].latitude,t[r].longitude];var e=i[0],f=i[1],o=i[2],u=i[3];return Math.abs(u-f)>360&&(f=-180,u=180),f=n._normalizeLongitude(f),u=n._normalizeLongitude(u),f>u&&(u+=360),i[1]=f,i[3]=u,i},n._normalizeLongitude=function(n){return n<-180||n>180?n-Math.floor((n+180)/360)*360:n},n._getZoomFromMetersPerPixel=function(i,r){return Math.log(Math.cos(n._degreesToRadians(i))*a/(t*r))/Math.log(2)},n.prototype._getAdjustedLocationAligningToGivenViewportCenter=function(i,r,u,f){var e=Math.pow(2,i),o=e*t,s=e*t,h=n._projectToMercatorX(r.latitude,r.longitude),c=n._projectToMercatorY(r.latitude,r.longitude),l=u-this._width/2,a=f-this._height/2,v=h-l/o,y=c-a/s;return{latitude:n._projectMercatorYToLatitude(y),longitude:n._projectMercatorXToLongitude(v)}},n._projectToMercatorX=function(n,t){return t/360+.5},n._projectToMercatorY=function(n){if(n>=r)return 0;if(n<=i)return 1;var t=Math.sin(n*u);return.5-Math.log((1+t)/(1-t))*1/(4*Math.PI)},n._projectMercatorXToLongitude=function(n){return(n-.5)*360},n._projectMercatorYToLatitude=function(n){return 90-2*Math.atan(Math.exp((n*2-1)*Math.PI))*l},n}();n.Primer=v})(g||(g={}));var ft=function(){function n(n,u,f,e,s,h,c,l){var a=this,y,k,tt,v,p,w,d,g,it,b,nt;if(this._disposables=[],this._disposables.push(this._mapLoaded=new r),this.layers=new ui,y=[],this._disposables.push(this.layers.changed.add(function(n){a._mapHasLoaded?a._onLayersChanged([n]):y.push(n)})),this._mapLoaded.addOne(function(){y.length>0&&a._onLayersChanged(y)}),this._rootElement=o(n),this._rootElement&&this._rootElement.length===1&&this._rootElement[0]){k=this._rootElement[0].$map;try{k&&k.dispose()}catch(rt){}this._rootElement[0].$map=this}if(u=u||{credentials:null},this._options=this._options||{credentials:null},this._options.viewChangeEndDelay=typeof u.viewChangeEndDelay=="number"?u.viewChangeEndDelay:0,u.mapTypeId&&(tt=u.mapTypeId===t.birdseye?t.birdseyeV2:u.mapTypeId,u.mapType=tt),u.trafficOptions=u.trafficOptions||{},u.trafficOptions.legendVisible=!0,typeof u.showLogo!="boolean"&&(u.showLogo=!0),(typeof u.showTermsLink=="undefined"||u.showTermsLink===null)&&(u.showTermsLink=!0),(typeof u.showBreadcrumb=="undefined"||u.showBreadcrumb===null)&&(u.showBreadcrumb=!1),v=u.supportedMapTypes,v&&v.length>0){for(p=[],w=0,d=v;w<d.length;w++)g=d[w],t.isValid(g)&&p.push(g);u.supportedMapTypes=p;v=p}it=v&&v.indexOf(t.birdseye)<0&&v.indexOf(t.birdseyeV2)<0;u.disableBirdseye=u.disableBirdseye||it||!v&&!e.isBirdseyeV2SDKDefault;typeof u.supportedMapTypes=="undefined"||u.supportedMapTypes===null||u.supportedMapTypes.length===0?(u.supportedMapTypes=[t.road,t.aerial,t.streetside,t.ordnanceSurvey],u.disableBirdseye||(Microsoft.Maps.GlobalConfig.isMapsAnswer&&!i._isFeatureEnabled("birdseyeV2UI")?u.supportedMapTypes.splice(2,0,t.birdseye):u.supportedMapTypes.splice(2,0,t.birdseyeV2))):(b=v.indexOf(t.birdseye),b>-1&&(u.disableBirdseye?u.supportedMapTypes.splice(b,1):u.supportedMapTypes[b]=t.birdseyeV2));nt=u.labelOptions=u.labelOptions||{};typeof nt.labelVisibility=="undefined"&&(nt.labelVisibility=u.labelOverlay);u.backgroundColor&&typeof u.backgroundColor!="string"&&(u.backgroundColor=u.backgroundColor.toHex());this._v8Map=new Microsoft.Maps.CoreMap(n,u,f,e,s,h,c,l);(u.bounds||u.center&&u.centerOffset)&&this.setView({bounds:u.bounds,center:u.center,centerOffset:u.centerOffset});this._disposables.push(this._v8Map);this._saveMapOptions(u);this._templateSelector=new kt(this._v8Map);this._v8Map.getOverlays()?this._onOverlayManagerLoaded():this._v8Map.overlayManagerLoaded.addOne(function(){a._onOverlayManagerLoaded()});this._disposables.push(this.copyrightchanged=new r);this._v8Map.copyrightControlLoaded.addOne(function(n){a._disposables.push(n.changed.add(function(n){n.name==="copyrightAttributions"&&a.copyrightchanged.invoke()}))});this._disposables.push(this.viewchangestart=new r,this.viewchange=new r,this.viewchangeend=new r,this._v8Map.mapPanStarted.add(function(n){a._raiseViewChangeStartEvent(n);a._isMapPanning=!0}),this._v8Map.mapPanStopped.add(function(n){a._raiseViewChangeEndEvent(n);a._isMapPanning=!1}),this._v8Map.targetViewChanged.add(function(n){a._v8Map.isPanning()||a._raiseViewChangeStartEvent(n)}),this._v8Map.viewChangingAfterPaint.add(function(n){a._raiseViewChangeEvent(n)}),this._v8Map.viewChanged.add(function(n){a._v8Map.isPanning()||a._raiseViewChangeEndEvent(n)}));this._v8Map.targetViewChanged.isPreviouslyInvoked&&(this._viewChangeStartInitializationTimer=window.setTimeout(function(){a._raiseViewChangeStartEvent(a._v8Map.targetViewChanged.lastInvokedArgs)},0));this._v8Map.viewChanged.isPreviouslyInvoked&&(this._viewChangeEndInitializationTimer=window.setTimeout(function(){a._raiseViewChangeEndEvent(a._v8Map.viewChanged.lastInvokedArgs)},0));this._disposables.push(this._v8Map.mapTypeChanged.add(function(n){n.oldMapTypeId!==t.birdseyeV2&&n.newMapTypeId===t.birdseyeV2?et.hideLayersForSDKMap(a):n.oldMapTypeId===t.birdseyeV2&&n.newMapTypeId!==t.birdseyeV2&&et.showLayersForSDKMap(a)}));this.entities=new bt(null,this._v8Map);this.entities.setTemplateSelector(this._templateSelector);this._v8Map.getLayers().insert(this.entities)}return n.prototype._raiseViewChangeStartEvent=function(n){this._viewChangeStartInvoked||(this._viewChangeStartInvoked=!0,this.viewchangestart.invoke(n));window.clearTimeout(this._viewChangeStartInitializationTimer);window.clearTimeout(this._viewChangeEndTimer)},n.prototype._raiseViewChangeEvent=function(n){this._viewChangeStartInvoked&&this.viewchange.invoke(n)},n.prototype._raiseViewChangeEndEvent=function(n){var t=this;this._options.viewChangeEndDelay>0?this._viewChangeEndTimer=window.setTimeout(function(){t._viewChangeStartInvoked=!1;t.viewchangeend.invoke(n)},this._options.viewChangeEndDelay):(this._viewChangeStartInvoked=!1,this.viewchangeend.invoke(n));window.clearTimeout(this._viewChangeEndInitializationTimer)},n.prototype._onLayersChanged=function(n){for(var e,u,o=this._v8Map.getLayers(),i=[],r=[],f=-1,t=0;t<n.length;t++)n[t]&&(n[t].added?(f===-1&&(f=n[t].addedIndex),i.push.apply(i,n[t].added)):n[t].removed&&r.push.apply(r,n[t].removed));if(i.length>0){for(e=[],t=0,u=i.length;t<u;t++)i[t]instanceof ti&&(i[t].setTemplateSelector(this._templateSelector),i[t]instanceof wt&&i[t].setOptions({enableCORS:this._v8Map.getMapOptions().enableCORS}),e.push(i[t]));for(o.insertAll(e,f),t=0,u=i.length;t<u;t++)i[t].attachMap&&i[t].attachMap(this)}if(r.length>0)for(t=0,u=r.length;t<u;t++)r[t].detachMap?r[t].detachMap(this):o.remove(r[t])},n.prototype._onOverlayManagerLoaded=function(){this._mapHasLoaded=!0;this._mapLoaded.invoke()},n.prototype.blur=function(){throw"Not implemented";},n.prototype.dispose=function(){var t,n;for(this._rootElement&&this._rootElement[0]&&delete this._rootElement[0].$map,i._clearDisposables(this._disposables),t=0;t<this.layers.length;t++)n=this.layers[t],n.pause&&n.pause(),n.dispose&&n.dispose(!0);this.layers.clear();this.entities.dispose(!0);this._rootElement&&this._rootElement.clear();this._rootElement=null;this._templateSelector=null;this._v8Map=null},n.prototype.focus=function(){throw"Not implemented";},n.prototype.getBounds=function(){return v.getMapBounds(this._v8Map)},n.prototype.getCenter=function(){return v.getMapCenter(this._v8Map)},n.prototype.getCopyrights=function(n){var t=this._v8Map.getCopyrightControl(),i=t&&t.copyrightProviders;n&&n(i)},n.prototype.getCredentials=function(n){ht.instance.authenticateClientAndRetrieveSessionId(function(){n&&n(ht.instance.getSessionId())})},n.prototype.getHeight=function(){return this._v8Map.getActualSize().height},n.prototype.getHeading=function(){return this._v8Map.getView().heading},n.prototype.getPitch=function(){return this._v8Map.getView().pitch},n.prototype.getImageryId=function(){return{r:"Road",a:"Aerial",be:"Birdseye",x:"Streetside",m:"Mercator",os:"Ordnance Survey",wd:"Canvas Dark",wl:"Canvas Light",cg:"Grayscale"}[this.getMapTypeId()]},n.prototype.getMapTypeId=function(){var n=this._v8Map.getMapType().id;return n===t.birdseyeV2&&(n=t.birdseye),n},n.prototype.getMapTypes=function(){for(var n,i=this.getV8Map().getMapTypes(),r=[],t=0;t<i.length;t++)n=i[t].id,n==="be2"&&(n="be"),r.push(n);return r},n.prototype.getMetersPerPixel=function(){return it.toScale(v.getMapCenter(this._v8Map),v.getMercatorZoomLevel(this._v8Map),!0)},n.prototype.getMode=function(){return this._v8Map.getMode()},n.prototype.getOptions=function(){return this._options},n.prototype.getPageX=function(){return this._rootElement.get_absolute_pos().x},n.prototype.getPageY=function(){return this._rootElement.get_absolute_pos().y},n.prototype.getRootElement=function(){return this._rootElement[0]},n.prototype.getWidth=function(){return this._v8Map.getActualSize().width},n.prototype.getZoom=function(){return this._v8Map.getMercatorZoomLevel()},n.prototype.getZoomRange=function(){var n=this._v8Map.getMapType();return{min:this._options.minZoom?Math.max(n.minZoom,this._options.minZoom):n.minZoom,max:this._options.maxZoom?Math.min(n.maxZoom,this._options.maxZoom):n.maxZoom}},n.prototype.isMercator=function(){return this._v8Map.getMode().mapModeType===0&&this._v8Map.getMapType().id!==t.birdseye},n.prototype.isRotationEnabled=function(){var n=this._v8Map.getMapType().id;return n===t.birdseye||n===t.birdseyeV2},n.prototype.setMapType=function(n){var i=this,r,u;if(n===t.birdseye&&(n=t.birdseyeV2),this._mapLoaded.isPreviouslyInvoked)if(this._options.mapTypeId=n,n===t.streetside)this._v8Map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(n){var t=i._options.streetsideOptions||{};t.heading=i._options.heading;t.pitch=i._options.pitch;n.show(t.panoramaInfo||a.cloneFrom(i._v8Map.getView().cameraLocation),t)});else{if(n===t.birdseye&&this._v8Map.getMapOptions().disableBirdseye)return;if(r=this._v8Map.getNavigationBar(),r?r.getAerialBirdsEyeTransitionManager().requestMapType(n):this._v8Map.navigationBarLoaded.addOne(function(){return i._v8Map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n)}),u=this._v8Map.getMapTypes()[n],u)this._v8Map.setBaseLayers(u);else throw"Invalid map type id"+n;this._v8Map.getMode().mapModeType!==0&&this._v8Map.getContainer().instanceAsync("CompositeMapMode",function(n){i._v8Map.setMode(n)})}else this._mapLoaded.addOne(function(){i.setMapType(n)})},n.prototype.setOptions=function(n){this._saveMapOptions(n);typeof n.minZoom=="number"&&this._v8Map.setMinZoom(n.minZoom);typeof n.maxZoom=="number"&&this._v8Map.setMaxZoom(n.maxZoom);n.maxBounds&&this._v8Map.setMaxBounds(n.maxBounds);this._v8Map.mapOptionsChanged.invoke(this._options)},n.prototype.setView=function(n){var r=this,i;this._processViewOptions(n);i=this.getMapTypeId();this._saveMapOptions(n);n.mapTypeId&&i!==n.mapTypeId?i===t.streetside?(this._v8Map.mapModeChanged.addOne(function(){r._setViewInternal(n,i)}),this.setMapType(n.mapTypeId)):(this.setMapType(n.mapTypeId),this._setViewInternal(n,i)):this._setViewInternal(n,i)},n.prototype._setViewInternal=function(n,i){var o=this,e,u,r,h,s,c,l,f;if(this.getMapTypeId()!==t.streetside){if(n.bounds){r=this._v8Map.getMode().getTilePyramid().getCrs();r.reset&&r.reset();e=n.bounds;u=typeof n.padding=="number"&&n.padding>0?n.padding:0;try{u*2<=Math.min(this.getHeight(),this.getWidth())?(f=this._v8Map.getMode().getMapViewWithBounds(e,{top:u,right:u,bottom:u,left:u}),this._v8Map.setView(f)):v.setMapCenter(this._v8Map,e.center,8)}catch(a){v.setMapCenter(this._v8Map,e.center,8)}}else(n.center||typeof n.zoom=="number"||n.center&&n.centerOffset)&&(r=this._v8Map.getMode().getTilePyramid().getCrs(),r.reset&&r.reset(),h=this._computeMapCenterAfterOffset(n)||this._v8Map.getView().cameraLocation,v.setMapCenter(this._v8Map,h,Math.round(typeof n.zoom=="number"?n.zoom:this.getZoom())));typeof n.labelOverlay=="number"&&(s=n.mapTypeId||this.getMapTypeId(),this._v8Map.getLabelController()?(c=n.labelOverlay===st.visible||s===t.road&&!this._options.allowHidingLabelsOfRoad?!0:!1,this._v8Map.getLabelController().setIsLabelsEnabled(c),this._v8Map.getMapOptions().labelOptions.labelVisibility=n.labelOverlay):this._v8Map.labelControllerLoaded.addOne(function(){var i=n.labelOverlay===st.visible||s===t.road&&!o._options.allowHidingLabelsOfRoad?!0:!1;o._v8Map.getLabelController().setIsLabelsEnabled(i);o._v8Map.getMapOptions().labelOptions.labelVisibility=n.labelOverlay}));typeof n.heading!="number"||n.mapTypeId!==t.birdseye&&n.mapTypeId!==t.birdseyeV2&&(n.mapTypeId||i!==t.birdseye&&i!==t.birdseyeV2)||(l=gt.normalizeHeading(n.heading),f=this._v8Map.getView().clone(),f.heading=l,this._v8Map.setView(f))}this._v8Map.setViewInvoked.invoke(n)},n.prototype.tryLocationToPixel=function(n,t){var r,i,u;if(n instanceof a)return this._trySingleLocationToPoint(n,t);if(n.length){for(r=[],i=0;i<n.length;i++)if(u=this._trySingleLocationToPoint(n[i],t),u)r.push(u);else return null;return r}},n.prototype.tryPixelToLocation=function(n,t){var r,i,u;if(n instanceof f)return this._trySinglePointToLocation(n,t);if(n.length){for(r=[],i=0;i<n.length;i++)if(u=this._trySinglePointToLocation(n[i],t),u)r.push(u);else return null;return r}},n.prototype.panTo=function(){throw"Not implemented";},n.prototype.getStreetSide=function(){throw"Not implemented";},n.prototype.setStreetSide=function(){throw"Not implemented";},n.prototype.getUserRegion=function(){return Microsoft.Maps.GlobalConfig.dynamicProperties.userRegion},n.prototype.getCulture=function(){return Microsoft.Maps.GlobalConfig.dynamicProperties.market},n.prototype.getReleaseType=function(){throw"Not implemented";},n.prototype.getImage=function(){throw"Not implemented";},n.getIsBirdseyeAvailable=function(n,t,i,r){et.getIsBirdseyeV2Available(Microsoft.Maps.Internal._CoreConfig(),n,t,i,r)},n.prototype.getV8Map=function(){return this._v8Map},n.prototype._trySingleLocationToPoint=function(n,t){var u=this._v8Map.getMode().tryLocationToPoint(n),i,r;if(u){t=typeof t=="number"?t:h.viewport;i=null;switch(t){case h.control:i=new f(0,0);break;case h.page:i=this._rootElement.get_absolute_pos();break;case h.viewport:default:i=this._v8Map.getMode().tryLocationToPoint(this._v8Map.getView().cameraLocation);i.x*=-1;i.y*=-1}return r=u.add(i),!isNaN(r.x)&&!isNaN(r.y)?r:null}return null},n.prototype._trySinglePointToLocation=function(n,t){var u,f,i,r;if(isNaN(n.x)||isNaN(n.y))return null;t=typeof t=="number"?t:h.viewport;n=n.clone();switch(t){case h.control:break;case h.page:u=this._rootElement.get_absolute_pos();n.x-=u.x;n.y-=u.y;break;case h.viewport:default:f=this._v8Map.getActualSize();n.x+=f.width/2;n.y+=f.height/2}try{i=this._v8Map.getMode().tryPointToLocation(n);r=i.longitude;(r<-180||r>180)&&(i.longitude=a.normalizeLongitude(r))}catch(e){return null}return i},n.prototype._saveMapOptions=function(n){this._v8Map.updateMapOptions(this._options,n)},n.prototype._computeMapCenterAfterOffset=function(n){var i=n.center,t,r;return i&&n.centerOffset&&(t=this.tryLocationToPixel(i),t&&(r=new f(typeof n.centerOffset.x=="number"?n.centerOffset.x:0,typeof n.centerOffset.y=="number"?n.centerOffset.y:0),t=t.subtract(r),i=this.tryPixelToLocation(t))),i},n.prototype._processViewOptions=function(n){if(typeof n.heading=="number"&&(n.heading=(n.heading%360+360)%360),typeof n.pitch=="number"){var t=n.pitch;n.pitch=Math.max(Math.min(t,90),-90)}},n}(),nr=function(){function n(){}return n.encode=function(t){for(var r,e,o=0,s=0,h=[],f=0,a=t.length;f<a;f++){var c=Math.round(t[f].latitude*1e5),l=Math.round(t[f].longitude*1e5),i=c-o,u=l-s;for(o=c,s=l,i=i<<1^i>>31,u=u<<1^u>>31,r=(i+u)*(i+u+1)/2+i;r>0;)e=r&31,r=(r-e)/32,r>0&&(e+=32),h.push(n._lookUpTable[e])}return h.join("")},n.decode=function(t){for(var l=[],h=0,v=0,y=0,p=t.length,r,c,f,e,i,u,o,s;h<p;){for(r=0,c=0;;){if(h>=p||(f=n._lookUpTable.indexOf(t[h++]),f===-1))return null;if(r+=(f&31)*Math.pow(2,c),c+=5,f<32)break}e=Math.floor((Math.sqrt(8*r+5)-1)/2);r-=e*(e+1)/2;i=r;u=e-i;u=u>>1^-(u&1);i=i>>1^-(i&1);v+=u;y+=i;o=y*1e-5;s=v*1e-5;o=Math.max(-85,Math.min(85,o));s=Math.max(-180,Math.min(180,s));l.push(new a(o,s))}return l},n._lookUpTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",n}(),tr=function(){function n(){}return n}();n.AnimatedTileLayer=gi;n.Color=pt;n.CustomOverlay=ut;n.EntityCollection=bt;n.Events=y;n.GroundOverlay=di;n.Infobox=ct;n.Layer=lt;n.PixelReference=h;n.Polygon=w;n.Polyline=d;n.Pushpin=l;n.SDKMap=ft;u.SDKPrimitiveTemplateSelector=kt;n.Module=rt;n.MouseEventArgs=bi;n.TestDataGenerator=ki;n.Themes={};n.Themes.BingTheme=tr;n.TileSource=wi;n.TileLayer=wt;n.MapsTilePrimer=typeof g!="undefined"?g:MapsTilePrimerV2;n.PointCompression=nr;n.loadModule=rt.loadModule;n.registerModule=rt.registerModule;n.moduleLoaded=rt.moduleLoaded;n.getIsBirdseyeAvailable=ft.getIsBirdseyeAvailable;Microsoft.Maps.notifyMapReadyForBootstrap()}).call(window)